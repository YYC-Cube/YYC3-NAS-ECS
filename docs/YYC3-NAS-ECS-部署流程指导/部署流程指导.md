# YYC3-NAS-ECS éƒ¨ç½²æµç¨‹æŒ‡å¯¼

> **æ–‡ä»¶æ ‡è¯†**: YYC3-NAS-ECS-éƒ¨ç½²æµç¨‹æŒ‡å¯¼
> **ç‰ˆæœ¬**: 1.0.0
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-14
> **ä½œè€…**: YYCÂ³ Team
> **æ–‡æ¡£ç±»å‹**: éƒ¨ç½²æµç¨‹æŒ‡å¯¼æ–‡æ¡£

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› YYC3-NAS-ECS é¡¹ç›®çš„å®Œæ•´éƒ¨ç½²æµç¨‹æŒ‡å¯¼ï¼Œæ¶µç›–ä»ç¯å¢ƒå‡†å¤‡åˆ°ç³»ç»Ÿä¸Šçº¿çš„å…¨æµç¨‹æ“ä½œã€‚æ–‡æ¡£éµå¾ªå›½å®¶æ ‡å‡†åŒ–ç¼–ç¨‹è§„èŒƒæ ¼å¼ï¼Œç¡®ä¿éƒ¨ç½²è¿‡ç¨‹çš„æ ‡å‡†åŒ–ã€è§„èŒƒåŒ–å’Œå¯è¿½æº¯æ€§ã€‚

### é€‚ç”¨èŒƒå›´

- æœ¬åœ° NAS ç¯å¢ƒéƒ¨ç½²
- é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨éƒ¨ç½²
- FRP åå‘ä»£ç†é…ç½®
- å¤šç¯å¢ƒéƒ¨ç½²ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰

### é¢„æœŸè¯»è€…

- ç³»ç»Ÿè¿ç»´å·¥ç¨‹å¸ˆ
- DevOps å·¥ç¨‹å¸ˆ
- æŠ€æœ¯æ¶æ„å¸ˆ
- é¡¹ç›®è´Ÿè´£äºº

---

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡

1. **é«˜å¯ç”¨æ€§**: ç¡®ä¿ç³»ç»Ÿ 99.9% å¯ç”¨æ€§
2. **é«˜æ€§èƒ½**: API å“åº”æ—¶é—´ < 200ms
3. **é«˜å®‰å…¨**: å®æ–½å®Œæ•´çš„å®‰å…¨é˜²æŠ¤æªæ–½
4. **é«˜æ‰©å±•**: æ”¯æŒæ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡
5. **é«˜ç»´æŠ¤**: æä¾›å®Œå–„çš„ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è®¿é—®å±‚                            â”‚
â”‚           (HTTPS/4443, HTTP/18080)                       â”‚
â”‚              api.0379.email, nas.0379.email, etc.       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¿é‡Œäº‘ ECS (8.152.195.33)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FRP Server (frps.toml)                                â”‚  â”‚
â”‚  â”‚  - ç›‘å¬ç«¯å£: 7001                                       â”‚  â”‚
â”‚  â”‚  - è™šæ‹Ÿä¸»æœºHTTP: 18080                                  â”‚  â”‚
â”‚  â”‚  - è™šæ‹Ÿä¸»æœºHTTPS: 4443                                 â”‚  â”‚
â”‚  â”‚  - ç®¡ç†é¢æ¿: 7500                                       â”‚  â”‚
â”‚  â”‚  - å­åŸŸå: 0379.email                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ FRP éš§é“ (TLSåŠ å¯†)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœ¬åœ° NAS (å†…ç½‘æœåŠ¡å™¨)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FRP Client (frpc.toml)                               â”‚  â”‚
â”‚  â”‚  - è¿æ¥ç«¯å£: 7001                                      â”‚  â”‚
â”‚  â”‚  - è®¤è¯ä»¤ç‰Œ: yyc3_nas                                   â”‚  â”‚
â”‚  â”‚  - TLSåŠ å¯†: å¯ç”¨                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æœ¬åœ°æœåŠ¡ (HTTPä»£ç†)                                   â”‚  â”‚
â”‚  â”‚  - API æœåŠ¡: ç«¯å£ 6000 (api.0379.email)            â”‚  â”‚
â”‚  â”‚  - NAS æœåŠ¡: ç«¯å£ 6001 (nas.0379.email)            â”‚  â”‚
â”‚  â”‚  - é‚®ä»¶æœåŠ¡: ç«¯å£ 6002 (mail.0379.email)          â”‚  â”‚
â”‚  â”‚  - LLM æœåŠ¡: ç«¯å£ 6003 (llm.0379.email)            â”‚  â”‚
â”‚  â”‚  - ç®¡ç†é¢æ¿: ç«¯å£ 6005 (admin.0379.email)        â”‚  â”‚
â”‚  â”‚  - ç›‘æ§æœåŠ¡: ç«¯å£ 6006 (monitor.0379.email)      â”‚  â”‚
â”‚  â”‚  - DDNS æœåŠ¡: ç«¯å£ 6007 (ddns.0379.email)        â”‚  â”‚
â”‚  â”‚  - Redis ç¼“å­˜: ç«¯å£ 6379                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ éƒ¨ç½²å‰å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚

#### 1.1 ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|---------|---------|
| CPU | 2 æ ¸ | 4 æ ¸åŠä»¥ä¸Š |
| å†…å­˜ | 4 GB | 8 GB åŠä»¥ä¸Š |
| å­˜å‚¨ | 50 GB SSD | 100 GB SSD åŠä»¥ä¸Š |
| ç½‘ç»œ | 10 Mbps | 100 Mbps åŠä»¥ä¸Š |

#### 1.2 è½¯ä»¶è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | ç”¨é€” |
|------|---------|------|
| æ“ä½œç³»ç»Ÿ | Ubuntu 20.04+ / CentOS 7+ | æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ |
| Docker | 20.10+ | å®¹å™¨åŒ–éƒ¨ç½² |
| Docker Compose | 2.0+ | å¤šå®¹å™¨ç¼–æ’ |
| Node.js | 18.0+ | å‰ç«¯æ„å»º |
| Python | 3.9+ | åç«¯æœåŠ¡ |
| Nginx | 1.18+ | åå‘ä»£ç† |
| FRP | 0.52.0+ | å†…ç½‘ç©¿é€ |

#### 1.3 ç½‘ç»œè¦æ±‚

- é˜¿é‡Œäº‘ ECS éœ€è¦å…¬ç½‘ IP
- æœ¬åœ° NAS éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
- é˜²ç«å¢™è§„åˆ™é…ç½®æ­£ç¡®
- åŸŸåè§£æé…ç½®å®Œæˆ

### 2. èµ„æºå‡†å¤‡

#### 2.1 æœåŠ¡å™¨èµ„æº

- é˜¿é‡Œäº‘ ECS å®ä¾‹ï¼ˆå·²è´­ä¹°å¹¶é…ç½®ï¼‰
- æœ¬åœ° NAS è®¾å¤‡ï¼ˆå·²å‡†å¤‡ï¼‰
- åŸŸåï¼ˆå·²è´­ä¹°å¹¶è§£æï¼‰

#### 2.2 è®¿é—®å‡­è¯

- é˜¿é‡Œäº‘ ECS SSH å¯†é’¥
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- FRP è®¤è¯ä»¤ç‰Œ
- API å¯†é’¥ï¼ˆå¦‚éœ€è¦ï¼‰

#### 2.3 é…ç½®æ–‡ä»¶

- ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼ˆ.env.*ï¼‰
- FRP é…ç½®æ–‡ä»¶ï¼ˆfrps.toml, frpc.tomlï¼‰
- Docker Compose é…ç½®æ–‡ä»¶ï¼ˆdocker-compose.ymlï¼‰
- Nginx é…ç½®æ–‡ä»¶ï¼ˆnginx.confï¼‰

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### é˜¶æ®µä¸€ï¼šç¯å¢ƒåˆå§‹åŒ–

#### æ­¥éª¤ 1.1: é˜¿é‡Œäº‘ ECS ç¯å¢ƒå‡†å¤‡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿æ¥åˆ° ECS æœåŠ¡å™¨
ssh root@your-ecs-ip

# 2. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 3. å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y curl wget git vim ufw

# 4. é…ç½®é˜²ç«å¢™
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 7001/tcp
sudo ufw allow 7500/tcp
sudo ufw enable

# 5. é…ç½®æ—¶åŒº
sudo timedatectl set-timezone Asia/Shanghai

# 6. åˆ›å»ºéƒ¨ç½²ç”¨æˆ·
sudo useradd -m -s /bin/bash deploy
sudo usermod -aG sudo deploy
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ç³»ç»Ÿç‰ˆæœ¬
lsb_release -a

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# æ£€æŸ¥æ—¶åŒº
timedatectl
```

#### æ­¥éª¤ 1.2: Docker ç¯å¢ƒå®‰è£…

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 2. å¯åŠ¨ Docker æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# 3. å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 4. å°† deploy ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
sudo usermod -aG docker deploy

# 5. éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Docker çŠ¶æ€
sudo systemctl status docker

# è¿è¡Œæµ‹è¯•å®¹å™¨
docker run hello-world
```

#### æ­¥éª¤ 1.3: æœ¬åœ° NAS ç¯å¢ƒå‡†å¤‡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿æ¥åˆ° NAS è®¾å¤‡
ssh user@your-nas-ip

# 2. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 3. å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y curl wget git vim

# 4. é…ç½®é˜²ç«å¢™
sudo ufw allow 22/tcp
sudo ufw allow 6000/tcp
sudo ufw allow 6002/tcp
sudo ufw allow 6003/tcp
sudo ufw allow 6005/tcp
sudo ufw allow 6006/tcp
sudo ufw allow 6007/tcp
sudo ufw allow 6379/tcp
sudo ufw enable

# 5. å®‰è£… Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 6. å®‰è£… Python
sudo apt install -y python3 python3-pip
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version
npm --version

# æ£€æŸ¥ Python ç‰ˆæœ¬
python3 --version
pip3 --version
```

### é˜¶æ®µäºŒï¼šä»£ç éƒ¨ç½²

#### æ­¥éª¤ 2.1: å…‹éš†ä»£ç ä»“åº“

**æ“ä½œå‘½ä»¤**:

```bash
# åœ¨ ECS æœåŠ¡å™¨ä¸Š
cd /opt
sudo git clone https://github.com/your-org/YYC3-NAS-ECS.git
sudo chown -R deploy:deploy YYC3-NAS-ECS
cd YYC3-NAS-ECS

# åœ¨æœ¬åœ° NAS ä¸Š
cd /home/user
git clone https://github.com/your-org/YYC3-NAS-ECS.git
cd YYC3-NAS-ECS
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ä»£ç ä»“åº“
ls -la

# æ£€æŸ¥ Git çŠ¶æ€
git status
```

#### æ­¥éª¤ 2.2: é…ç½®ç¯å¢ƒå˜é‡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.ports .env.local
cp config/.env.base config/.env.development
cp config/.env.base config/.env.production

# 2. ç¼–è¾‘ç¯å¢ƒå˜é‡æ–‡ä»¶
vim .env.local
```

**é…ç½®å†…å®¹**:

```bash
# ç«¯å£é…ç½®
API_PORT=6000
NAS_PORT=6001
MAIL_PORT=6002
LLM_PORT=6003
ADMIN_PORT=6005
MONITOR_PORT=6006
DDNS_PORT=6007
REDIS_PORT=6379

# æœåŠ¡å™¨é…ç½®
ECS_HOST=8.152.195.33
NAS_HOST=your-nas-ip

# FRP é…ç½®
FRP_SERVER_ADDR=8.152.195.33
FRP_SERVER_PORT=7001
FRP_AUTH_TOKEN=yyc3_nas

# å­åŸŸåé…ç½®
SUBDOMAIN_HOST=0379.email

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=yyc3_nas_ecs
DB_USER=yyc3_user
DB_PASSWORD=your-db-password

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password

# API é…ç½®
API_BASE_URL=http://localhost:6000
API_TIMEOUT=30000

# LLM é…ç½®
LLM_API_KEY=your-llm-api-key
LLM_MODEL=gpt-4
LLM_MAX_TOKENS=2000

# é‚®ä»¶é…ç½®
MAIL_HOST=smtp.example.com
MAIL_PORT=587
MAIL_USER=your-email@example.com
MAIL_PASSWORD=your-email-password
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env.local

# éªŒè¯é…ç½®æ ¼å¼
source .env.local
echo $API_PORT
```

### é˜¶æ®µä¸‰ï¼šFRP é…ç½®éƒ¨ç½²

#### æ­¥éª¤ 3.1: é…ç½® FRP æœåŠ¡å™¨ï¼ˆECSï¼‰

**æ“ä½œå‘½ä»¤**:

```bash
# 1. åˆ›å»º FRP é…ç½®ç›®å½•
sudo mkdir -p /opt/frp
cd /opt/frp

# 2. ä¸‹è½½ FRP
wget https://github.com/fatedier/frp/releases/download/v0.52.0/frp_0.52.0_linux_amd64.tar.gz
tar -xzf frp_0.52.0_linux_amd64.tar.gz
cd frp_0.52.0_linux_amd64

# 3. ç¼–è¾‘ FRP æœåŠ¡å™¨é…ç½®
vim frps.toml
```

**é…ç½®å†…å®¹**:

```toml
# FRP æœåŠ¡å™¨é…ç½®
bindAddr = "0.0.0.0"
bindPort = 7001

# è®¤è¯é…ç½®
auth.method = "token"
auth.token = "yyc3_nas"

# è™šæ‹Ÿä¸»æœºç«¯å£
vhostHTTPPort = 18080
vhostHTTPSPort = 4443

# å­åŸŸåä¸»æœº
subDomainHost = "0379.email"

# ç®¡ç†é¢æ¿é…ç½®
webServer.addr = "0.0.0.0"
webServer.port = 7500
webServer.user = "yyc3"
webServer.password = "my151001"

# TLS é…ç½®
transport.tls.certFile = "/etc/letsencrypt/live/0379.email/fullchain.pem"
transport.tls.keyFile = "/etc/letsencrypt/live/0379.email/privkey.pem"

# å…è®¸ç«¯å£èŒƒå›´
allowPorts = [
  { start = 6000, end = 6009 },
  { start = 8080, end = 8080 }
]

# æ—¥å¿—é…ç½®
log.to = "/root/frps/frps.log"
log.level = "warn"
log.maxDays = 7

# ä¼ è¾“é…ç½®
transport.maxPoolCount = 5
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 4. åˆ›å»º systemd æœåŠ¡
sudo vim /etc/systemd/system/frps.service
```

**æœåŠ¡é…ç½®**:

```ini
[Unit]
Description=FRP Server Service
After=network.target

[Service]
Type=simple
User=deploy
WorkingDirectory=/opt/frp/frp_0.52.0_linux_amd64
ExecStart=/opt/frp/frp_0.52.0_linux_amd64/frps -c /opt/frp/frp_0.52.0_linux_amd64/frps.toml
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 5. å¯åŠ¨ FRP æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable frps
sudo systemctl start frps

# 6. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status frps
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ FRP æœåŠ¡ç›‘å¬ç«¯å£
sudo netstat -tlnp | grep frps

# è®¿é—® FRP ç®¡ç†é¢æ¿
# æµè§ˆå™¨è®¿é—®: http://8.152.195.33:7500
# ç”¨æˆ·å: yyc3
# å¯†ç : my151001
```

#### æ­¥éª¤ 3.2: é…ç½® FRP å®¢æˆ·ç«¯ï¼ˆNASï¼‰

**æ“ä½œå‘½ä»¤**:

```bash
# 1. ä¸‹è½½ FRP
cd /home/user/YYC3-NAS-ECS
wget https://github.com/fatedier/frp/releases/download/v0.52.0/frp_0.52.0_linux_amd64.tar.gz
tar -xzf frp_0.52.0_linux_amd64.tar.gz
cd frp_0.52.0_linux_amd64

# 2. ç¼–è¾‘ FRP å®¢æˆ·ç«¯é…ç½®
vim frpc.toml
```

**é…ç½®å†…å®¹**:

```toml
# FRP å®¢æˆ·ç«¯é…ç½®
serverAddr = "8.152.195.33"
serverPort = 7001

# è®¤è¯é…ç½®
auth.method = "token"
auth.token = "yyc3_nas"

# æ—¥å¿—é…ç½®
log.to = "/Volume1/www/frpc/logs/frpc.log"
log.level = "debug"

# TLS é…ç½®
transport.tls.enable = true

# ä»£ç†é…ç½® - API æœåŠ¡
[[proxies]]
name = "api-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6000
subdomain = "api"

# ä»£ç†é…ç½® - NAS æœåŠ¡
[[proxies]]
name = "nas-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6001
subdomain = "nas"

# ä»£ç†é…ç½® - é‚®ä»¶æœåŠ¡
[[proxies]]
name = "mail-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6002
subdomain = "mail"

# ä»£ç†é…ç½® - LLM æœåŠ¡
[[proxies]]
name = "llm-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6003
subdomain = "llm"

# ä»£ç†é…ç½® - ç®¡ç†é¢æ¿
[[proxies]]
name = "admin-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6005
subdomain = "admin"

# ä»£ç†é…ç½® - ç›‘æ§æœåŠ¡
[[proxies]]
name = "monitor-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6006
subdomain = "monitor"

# ä»£ç†é…ç½® - DDNS æœåŠ¡
[[proxies]]
name = "ddns-0379"
type = "http"
localIP = "127.0.0.1"
localPort = 6007
subdomain = "ddns"
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 3. åˆ›å»º systemd æœåŠ¡
sudo vim /etc/systemd/system/frpc.service
```

**æœåŠ¡é…ç½®**:

```ini
[Unit]
Description=FRP Client Service
After=network.target

[Service]
Type=simple
User=user
WorkingDirectory=/home/user/YYC3-NAS-ECS/frp_0.52.0_linux_amd64
ExecStart=/home/user/YYC3-NAS-ECS/frp_0.52.0_linux_amd64/frpc -c /home/user/YYC3-NAS-ECS/frp_0.52.0_linux_amd64/frpc.toml
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 4. å¯åŠ¨ FRP å®¢æˆ·ç«¯
sudo systemctl daemon-reload
sudo systemctl enable frpc
sudo systemctl start frpc

# 5. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status frpc
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ FRP å®¢æˆ·ç«¯è¿æ¥çŠ¶æ€
sudo systemctl status frpc

# æ£€æŸ¥æ—¥å¿—
sudo journalctl -u frpc -f

# åœ¨ FRP ç®¡ç†é¢æ¿æŸ¥çœ‹ä»£ç†çŠ¶æ€
# æµè§ˆå™¨è®¿é—®: http://your-ecs-ip:7500
```

### é˜¶æ®µå››ï¼šåº”ç”¨æœåŠ¡éƒ¨ç½²

#### æ­¥éª¤ 4.1: éƒ¨ç½² API æœåŠ¡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿›å…¥ API ç›®å½•
cd /opt/YYC3-NAS-ECS/api

# 2. å®‰è£… Python ä¾èµ–
pip3 install -r requirements.txt

# 3. åˆå§‹åŒ–æ•°æ®åº“
python3 scripts/init_db.py

# 4. å¯åŠ¨ API æœåŠ¡
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 6000
```

**Docker éƒ¨ç½²æ–¹å¼**:

```bash
# 1. æ„å»º Docker é•œåƒ
cd /opt/YYC3-NAS-ECS/api
docker build -t yyc3-nas-ecs-api:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name yyc3-api \
  -p 6000:6000 \
  --env-file /opt/YYC3-NAS-ECS/.env.local \
  yyc3-nas-ecs-api:latest
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ API æœåŠ¡çŠ¶æ€
curl http://localhost:6000/health

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep yyc3-api

# æŸ¥çœ‹æ—¥å¿—
docker logs yyc3-api
```

#### æ­¥éª¤ 4.2: éƒ¨ç½²å‰ç«¯æœåŠ¡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd /opt/YYC3-NAS-ECS

# 2. å®‰è£…ä¾èµ–
npm install

# 3. æ„å»ºå‰ç«¯
npm run build

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**Docker éƒ¨ç½²æ–¹å¼**:

```bash
# 1. æ„å»º Docker é•œåƒ
cd /opt/YYC3-NAS-ECS
docker build -t yyc3-nas-ecs-frontend:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name yyc3-frontend \
  -p 6005:6005 \
  --env-file /opt/YYC3-NAS-ECS/.env.local \
  yyc3-nas-ecs-frontend:latest
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€
curl http://localhost:6005

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep yyc3-frontend

# æŸ¥çœ‹æ—¥å¿—
docker logs yyc3-frontend
```

#### æ­¥éª¤ 4.3: éƒ¨ç½² LLM æœåŠ¡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿›å…¥ LLM æœåŠ¡ç›®å½•
cd /opt/YYC3-NAS-ECS/services/llm

# 2. å®‰è£…ä¾èµ–
pip3 install -r requirements.txt

# 3. å¯åŠ¨ LLM æœåŠ¡
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 6002
```

**Docker éƒ¨ç½²æ–¹å¼**:

```bash
# 1. æ„å»º Docker é•œåƒ
docker build -t yyc3-nas-ecs-llm:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name yyc3-llm \
  -p 6002:6002 \
  --env-file /opt/YYC3-NAS-ECS/.env.local \
  yyc3-nas-ecs-llm:latest
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ LLM æœåŠ¡çŠ¶æ€
curl http://localhost:6002/health

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep yyc3-llm

# æŸ¥çœ‹æ—¥å¿—
docker logs yyc3-llm
```

#### æ­¥éª¤ 4.4: éƒ¨ç½²é‚®ä»¶æœåŠ¡

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿›å…¥é‚®ä»¶æœåŠ¡ç›®å½•
cd /opt/YYC3-NAS-ECS/services/mail

# 2. å®‰è£…ä¾èµ–
npm install

# 3. å¯åŠ¨é‚®ä»¶æœåŠ¡
npm start
```

**Docker éƒ¨ç½²æ–¹å¼**:

```bash
# 1. æ„å»º Docker é•œåƒ
docker build -t yyc3-nas-ecs-mail:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name yyc3-mail \
  -p 6003:6003 \
  --env-file /opt/YYC3-NAS-ECS/.env.local \
  yyc3-nas-ecs-mail:latest
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥é‚®ä»¶æœåŠ¡çŠ¶æ€
curl http://localhost:6003/health

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep yyc3-mail

# æŸ¥çœ‹æ—¥å¿—
docker logs yyc3-mail
```

#### æ­¥éª¤ 4.5: ä½¿ç”¨ Docker Compose éƒ¨ç½²

**æ“ä½œå‘½ä»¤**:

```bash
# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /opt/YYC3-NAS-ECS

# 2. ä½¿ç”¨ Docker Compose å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

**Docker Compose é…ç½®**:

```yaml
version: '3.8'

services:
  api:
    build: ./api
    container_name: yyc3-api
    ports:
      - "6000:6000"
    env_file:
      - .env.local
    depends_on:
      - redis
    restart: unless-stopped

  frontend:
    build: .
    container_name: yyc3-frontend
    ports:
      - "6005:6005"
    env_file:
      - .env.local
    depends_on:
      - api
    restart: unless-stopped

  llm:
    build: ./services/llm
    container_name: yyc3-llm
    ports:
      - "6002:6002"
    env_file:
      - .env.local
    restart: unless-stopped

  mail:
    build: ./services/mail
    container_name: yyc3-mail
    ports:
      - "6003:6003"
    env_file:
      - .env.local
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: yyc3-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  redis_data:
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:6000/health
curl http://localhost:6005
curl http://localhost:6002/health
curl http://localhost:6003/health

# æ£€æŸ¥ Redis è¿æ¥
docker exec -it yyc3-redis redis-cli ping
```

### é˜¶æ®µäº”ï¼šNginx åå‘ä»£ç†é…ç½®

#### æ­¥éª¤ 5.1: å®‰è£… Nginx

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å®‰è£… Nginx
sudo apt install -y nginx

# 2. å¯åŠ¨ Nginx
sudo systemctl start nginx
sudo systemctl enable nginx

# 3. æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Nginx ç‰ˆæœ¬
nginx -v

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# è®¿é—®é»˜è®¤é¡µé¢
curl http://localhost
```

#### æ­¥éª¤ 5.2: é…ç½® Nginx åå‘ä»£ç†

**æ“ä½œå‘½ä»¤**:

```bash
# 1. åˆ›å»ºç«™ç‚¹é…ç½®æ–‡ä»¶
sudo vim /etc/nginx/sites-available/yyc3-nas-ecs
```

**é…ç½®å†…å®¹**:

```nginx
# HTTP æœåŠ¡å™¨é…ç½®
server {
    listen 80;
    server_name your-domain.com;

    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

# HTTPS æœåŠ¡å™¨é…ç½®
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # SSL å®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/yyc3-nas-ecs-access.log;
    error_log /var/log/nginx/yyc3-nas-ecs-error.log;

    # API æœåŠ¡ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:6000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    # LLM æœåŠ¡ä»£ç†
    location /llm/ {
        proxy_pass http://127.0.0.1:6002/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    # é‚®ä»¶æœåŠ¡ä»£ç†
    location /mail/ {
        proxy_pass http://127.0.0.1:6003/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    # å‰ç«¯æœåŠ¡ä»£ç†
    location / {
        proxy_pass http://127.0.0.1:6005/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    # FRP ç®¡ç†é¢æ¿ä»£ç†
    location /frp/ {
        proxy_pass http://127.0.0.1:7500/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        auth_basic "FRP Management";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 2. å¯ç”¨ç«™ç‚¹é…ç½®
sudo ln -s /etc/nginx/sites-available/yyc3-nas-ecs /etc/nginx/sites-enabled/

# 3. åˆ é™¤é»˜è®¤ç«™ç‚¹
sudo rm /etc/nginx/sites-enabled/default

# 4. æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# 5. é‡è½½ Nginx é…ç½®
sudo systemctl reload nginx
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# è®¿é—®ç½‘ç«™
curl https://your-domain.com
```

#### æ­¥éª¤ 5.3: é…ç½® SSL è¯ä¹¦

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# 2. è·å– SSL è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# 3. è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# 4. æ·»åŠ ç»­æœŸå®šæ—¶ä»»åŠ¡
sudo crontab -e
```

**å®šæ—¶ä»»åŠ¡é…ç½®**:

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ£€æŸ¥è¯ä¹¦ç»­æœŸ
0 2 * * * /usr/bin/certbot renew --quiet
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# æ£€æŸ¥ SSL é…ç½®
curl -I https://your-domain.com
```

### é˜¶æ®µå…­ï¼šç³»ç»ŸéªŒè¯

#### æ­¥éª¤ 6.1: æœåŠ¡å¥åº·æ£€æŸ¥

**æ“ä½œå‘½ä»¤**:

```bash
# 1. æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status frps
sudo systemctl status nginx
docker-compose ps

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep -E '6000|6001|6002|6003|6005|6006|6007|7001|7500'

# 3. æ£€æŸ¥ FRP è¿æ¥
curl http://localhost:7500/api/proxies
```

**éªŒè¯æ–¹æ³•**:

```bash
# API æœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:6000/health

# LLM æœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:6002/health

# é‚®ä»¶æœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:6003/health

# å‰ç«¯æœåŠ¡æ£€æŸ¥
curl http://localhost:6005

# FRP ç®¡ç†é¢æ¿æ£€æŸ¥
curl http://localhost:7500
```

#### æ­¥éª¤ 6.2: åŠŸèƒ½éªŒè¯

**æ“ä½œå‘½ä»¤**:

```bash
# 1. æµ‹è¯• API ç«¯ç‚¹
curl -X GET https://your-domain.com/api/v1/status

# 2. æµ‹è¯• LLM æœåŠ¡
curl -X POST https://your-domain.com/llm/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello"}'

# 3. æµ‹è¯•é‚®ä»¶æœåŠ¡
curl -X POST https://your-domain.com/mail/v1/send \
  -H "Content-Type: application/json" \
  -d '{"to": "test@example.com", "subject": "Test", "body": "Test message"}'
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ API å“åº”
curl -X GET https://your-domain.com/api/v1/status | jq

# æ£€æŸ¥ LLM å“åº”
curl -X POST https://your-domain.com/llm/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello"}' | jq

# æ£€æŸ¥é‚®ä»¶å‘é€
# æŸ¥çœ‹é‚®ä»¶æ”¶ä»¶ç®±ç¡®è®¤æ”¶åˆ°æµ‹è¯•é‚®ä»¶
```

#### æ­¥éª¤ 6.3: æ€§èƒ½éªŒè¯

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…·
sudo apt install -y apache2-utils

# 2. æ‰§è¡Œ API æ€§èƒ½æµ‹è¯•
ab -n 1000 -c 10 https://your-domain.com/api/v1/status

# 3. æ‰§è¡Œå‰ç«¯æ€§èƒ½æµ‹è¯•
ab -n 1000 -c 10 https://your-domain.com/

# 4. æ£€æŸ¥ç³»ç»Ÿèµ„æº
htop
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥æ€§èƒ½æµ‹è¯•ç»“æœ
# API å“åº”æ—¶é—´åº” < 200ms
# å‰ç«¯åŠ è½½æ—¶é—´åº” < 2s

# æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨
# CPU ä½¿ç”¨ç‡åº” < 70%
# å†…å­˜ä½¿ç”¨ç‡åº” < 80%
# ç£ç›˜ä½¿ç”¨ç‡åº” < 80%
```

#### æ­¥éª¤ 6.4: å®‰å…¨éªŒè¯

**æ“ä½œå‘½ä»¤**:

```bash
# 1. æ£€æŸ¥ SSL è¯ä¹¦
openssl s_client -connect your-domain.com:443 -servername your-domain.com

# 2. æ£€æŸ¥å®‰å…¨å¤´
curl -I https://your-domain.com

# 3. æ‰§è¡Œå®‰å…¨æ‰«æ
sudo apt install -y nikto
nikto -h https://your-domain.com
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ SSL è¯ä¹¦æœ‰æ•ˆæ€§
# è¯ä¹¦åº”æœ‰æ•ˆä¸”æœªè¿‡æœŸ

# æ£€æŸ¥å®‰å…¨å¤´
# åº”åŒ…å« X-Frame-Options, X-Content-Type-Options, X-XSS-Protection

# æ£€æŸ¥å®‰å…¨æ‰«æç»“æœ
# åº”æ— ä¸¥é‡å®‰å…¨æ¼æ´
```

---

## ğŸ“Š éƒ¨ç½²åç›‘æ§

### 1. ç³»ç»Ÿç›‘æ§

#### 1.1 å®‰è£…ç›‘æ§å·¥å…·

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å®‰è£… Prometheus
sudo apt install -y prometheus

# 2. å®‰è£… Grafana
sudo apt install -y grafana

# 3. å¯åŠ¨ç›‘æ§æœåŠ¡
sudo systemctl start prometheus
sudo systemctl start grafana
sudo systemctl enable prometheus
sudo systemctl enable grafana
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Prometheus çŠ¶æ€
sudo systemctl status prometheus

# è®¿é—® Prometheus
# æµè§ˆå™¨è®¿é—®: http://your-ecs-ip:9090

# è®¿é—® Grafana
# æµè§ˆå™¨è®¿é—®: http://your-ecs-ip:3000
```

#### 1.2 é…ç½®ç›‘æ§æŒ‡æ ‡

**Prometheus é…ç½®**:

```yaml
# /etc/prometheus/prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'yyc3-api'
    static_configs:
      - targets: ['localhost:6000']
    metrics_path: '/metrics'

  - job_name: 'yyc3-llm'
    static_configs:
      - targets: ['localhost:6002']
    metrics_path: '/metrics'

  - job_name: 'yyc3-mail'
    static_configs:
      - targets: ['localhost:6003']
    metrics_path: '/metrics'

  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Prometheus é…ç½®
sudo promtool check config /etc/prometheus/prometheus.yml

# é‡è½½ Prometheus é…ç½®
sudo systemctl reload prometheus

# è®¿é—® Prometheus ç›®æ ‡é¡µé¢
# æµè§ˆå™¨è®¿é—®: http://your-ecs-ip:9090/targets
```

### 2. æ—¥å¿—ç®¡ç†

#### 2.1 é…ç½®æ—¥å¿—æ”¶é›†

**æ“ä½œå‘½ä»¤**:

```bash
# 1. å®‰è£… Filebeat
sudo apt install -y filebeat

# 2. é…ç½® Filebeat
sudo vim /etc/filebeat/filebeat.yml
```

**Filebeat é…ç½®**:

```yaml
filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /var/log/nginx/*.log
    fields:
      service: nginx
    fields_under_root: true

  - type: docker
    enabled: true
    containers.ids: '*'
    processors:
      - add_docker_metadata:
          host: "unix:///var/run/docker.sock"

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "yyc3-nas-ecs-%{+yyyy.MM.dd}"

setup.kibana:
  host: "localhost:5601"
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 3. å¯åŠ¨ Filebeat
sudo systemctl start filebeat
sudo systemctl enable filebeat

# 4. éªŒè¯ Filebeat çŠ¶æ€
sudo systemctl status filebeat
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥ Filebeat æ—¥å¿—
sudo journalctl -u filebeat -f

# æ£€æŸ¥ Elasticsearch ç´¢å¼•
curl http://localhost:9200/_cat/indices?v

# è®¿é—® Kibana
# æµè§ˆå™¨è®¿é—®: http://your-ecs-ip:5601
```

### 3. å‘Šè­¦é…ç½®

#### 3.1 é…ç½®å‘Šè­¦è§„åˆ™

**Prometheus å‘Šè­¦è§„åˆ™**:

```yaml
# /etc/prometheus/alerts.yml
groups:
  - name: yyc3-nas-ecs
    rules:
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is above 80% for more than 5 minutes"

      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is above 80% for more than 5 minutes"

      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service is down"
          description: "Service {{ $labels.instance }} is down"

      - alert: APIHighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High API latency detected"
          description: "API 95th percentile latency is above 500ms"
```

**æ“ä½œå‘½ä»¤**:

```bash
# 1. æ›´æ–° Prometheus é…ç½®
sudo vim /etc/prometheus/prometheus.yml

# æ·»åŠ å‘Šè­¦è§„åˆ™é…ç½®
rule_files:
  - "/etc/prometheus/alerts.yml"

# 2. é‡è½½ Prometheus é…ç½®
sudo systemctl reload prometheus

# 3. éªŒè¯å‘Šè­¦è§„åˆ™
curl http://localhost:9090/api/v1/rules
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥å‘Šè­¦è§„åˆ™
# æµè§ˆå™¨è®¿é—®: http://your-ecs-ip:9090/alerts

# æµ‹è¯•å‘Šè­¦è§¦å‘
# åœæ­¢ä¸€ä¸ªæœåŠ¡å¹¶è§‚å¯Ÿå‘Šè­¦æ˜¯å¦è§¦å‘
```

---

## ğŸ”§ è¿ç»´ç®¡ç†

### 1. æ—¥å¸¸ç»´æŠ¤

#### 1.1 æœåŠ¡é‡å¯

**æ“ä½œå‘½ä»¤**:

```bash
# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart api

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ FRP æœåŠ¡
sudo systemctl restart frps
sudo systemctl restart frpc

# é‡å¯ Nginx
sudo systemctl restart nginx
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
sudo systemctl status frps
sudo systemctl status nginx
```

#### 1.2 æ—¥å¿—æŸ¥çœ‹

**æ“ä½œå‘½ä»¤**:

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f api
docker-compose logs -f frontend
docker-compose logs -f llm
docker-compose logs -f mail

# æŸ¥çœ‹ FRP æ—¥å¿—
sudo journalctl -u frps -f
sudo journalctl -u frpc -f

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/yyc3-nas-ecs-access.log
sudo tail -f /var/log/nginx/yyc3-nas-ecs-error.log
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥æ—¥å¿—è¾“å‡º
# ç¡®è®¤æ—¥å¿—æ­£å¸¸è¾“å‡ºä¸”æ— é”™è¯¯ä¿¡æ¯
```

#### 1.3 æ•°æ®å¤‡ä»½

**æ“ä½œå‘½ä»¤**:

```bash
# 1. åˆ›å»ºå¤‡ä»½ç›®å½•
sudo mkdir -p /backup/yyc3-nas-ecs

# 2. å¤‡ä»½æ•°æ®åº“
docker exec yyc3-postgres pg_dump -U yyc3_user yyc3_nas_ecs > /backup/yyc3-nas-ecs/db_backup_$(date +%Y%m%d).sql

# 3. å¤‡ä»½ Redis
docker exec yyc3-redis redis-cli BGSAVE
docker cp yyc3-redis:/data/dump.rdb /backup/yyc3-nas-ecs/redis_backup_$(date +%Y%m%d).rdb

# 4. å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf /backup/yyc3-nas-ecs/config_backup_$(date +%Y%m%d).tar.gz /opt/YYC3-NAS-ECS/.env.local /opt/YYC3-NAS-ECS/frp/*.toml

# 5. è®¾ç½®å®šæ—¶å¤‡ä»½
sudo crontab -e
```

**å®šæ—¶ä»»åŠ¡é…ç½®**:

```bash
# æ¯å¤©å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œå¤‡ä»½
0 3 * * * /opt/YYC3-NAS-ECS/scripts/backup.sh
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
ls -lh /backup/yyc3-nas-ecs/

# éªŒè¯å¤‡ä»½å®Œæ•´æ€§
# æ¢å¤æµ‹è¯•
```

### 2. æ•…éšœæ’æŸ¥

#### 2.1 å¸¸è§é—®é¢˜

**é—®é¢˜ 1: FRP è¿æ¥å¤±è´¥**

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ FRP æœåŠ¡çŠ¶æ€
sudo systemctl status frps
sudo systemctl status frpc

# 2. æ£€æŸ¥ FRP æ—¥å¿—
sudo journalctl -u frps -n 50
sudo journalctl -u frpc -n 50

# 3. æ£€æŸ¥ç½‘ç»œè¿æ¥
telnet 8.152.195.33 7001

# 4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
sudo iptables -L -n

# 5. æ£€æŸ¥ FRP é…ç½®
cat /opt/frp/frps.toml
cat /home/user/YYC3-NAS-ECS/frpc.toml
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. é‡å¯ FRP æœåŠ¡
sudo systemctl restart frps
sudo systemctl restart frpc

# 2. ä¿®æ­£ FRP é…ç½®
vim /opt/frp/frps.toml
vim /home/user/YYC3-NAS-ECS/frpc.toml

# 3. æ›´æ–°é˜²ç«å¢™è§„åˆ™
sudo ufw allow 7001/tcp

# 4. éªŒè¯è¿æ¥
curl http://your-ecs-ip:7500
```

**é—®é¢˜ 2: API æœåŠ¡æ— å“åº”**

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ API æœåŠ¡çŠ¶æ€
docker-compose ps api

# 2. æ£€æŸ¥ API æœåŠ¡æ—¥å¿—
docker-compose logs api

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 6000

# 4. æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec -it yyc3-postgres psql -U yyc3_user -d yyc3_nas_ecs

# 5. æµ‹è¯• API ç«¯ç‚¹
curl http://localhost:6000/health
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. é‡å¯ API æœåŠ¡
docker-compose restart api

# 2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
# æ›´æ–°æ•°æ®åº“é…ç½®
vim /opt/YYC3-NAS-ECS/.env.local

# 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs -f api
```

**é—®é¢˜ 3: å‰ç«¯é¡µé¢æ— æ³•è®¿é—®**

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€
docker-compose ps frontend

# 2. æ£€æŸ¥å‰ç«¯æœåŠ¡æ—¥å¿—
docker-compose logs frontend

# 3. æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# 4. æ£€æŸ¥ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/yyc3-nas-ecs-error.log

# 5. æµ‹è¯•å‰ç«¯æœåŠ¡
curl http://localhost:6005
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. é‡å¯å‰ç«¯æœåŠ¡
docker-compose restart frontend

# 2. é‡å¯ Nginx
sudo systemctl restart nginx

# 3. æ£€æŸ¥ SSL è¯ä¹¦
sudo certbot certificates
```

**é—®é¢˜ 4: æ€§èƒ½ä¸‹é™**

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ç³»ç»Ÿèµ„æº
htop
df -h
free -m

# 2. æ£€æŸ¥æœåŠ¡èµ„æºä½¿ç”¨
docker stats

# 3. æ£€æŸ¥æ•°æ®åº“æ€§èƒ½
docker exec -it yyc3-postgres psql -U yyc3_user -d yyc3_nas_ecs -c "SELECT * FROM pg_stat_activity;"

# 4. æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—
docker exec -it yyc3-postgres psql -U yyc3_user -d yyc3_nas_ecs -c "SELECT * FROM pg_stat_statements ORDER BY total_time DESC LIMIT 10;"

# 5. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping your-ecs-ip
traceroute your-ecs-ip
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
# æ·»åŠ ç´¢å¼•
# ä¼˜åŒ– SQL è¯­å¥

# 2. å¢åŠ  Redis ç¼“å­˜
# é…ç½®ç¼“å­˜ç­–ç•¥

# 3. æ‰©å±•æœåŠ¡èµ„æº
# å¢åŠ å®¹å™¨èµ„æºé™åˆ¶
docker-compose up -d --scale api=2

# 4. ä¼˜åŒ– Nginx é…ç½®
# å¯ç”¨ gzip å‹ç¼©
# é…ç½®ç¼“å­˜ç­–ç•¥
```

#### 2.2 åº”æ€¥å¤„ç†

**åœºæ™¯ 1: æœåŠ¡å®Œå…¨å®•æœº**

**åº”æ€¥æ­¥éª¤**:

```bash
# 1. ç«‹å³æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
sudo systemctl status frps
sudo systemctl status nginx

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs --tail=100
sudo journalctl -u frps -n 100
sudo tail -100 /var/log/nginx/yyc3-nas-ecs-error.log

# 3. å°è¯•é‡å¯æœåŠ¡
docker-compose restart
sudo systemctl restart frps
sudo systemctl restart nginx

# 4. æ£€æŸ¥ç³»ç»Ÿèµ„æº
htop
df -h
free -m

# 5. è”ç³»æŠ€æœ¯æ”¯æŒ
# è®°å½•æ‰€æœ‰é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
```

**åœºæ™¯ 2: æ•°æ®åº“è¿æ¥å¤±è´¥**

**åº”æ€¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
docker-compose ps postgres

# 2. æ£€æŸ¥æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres

# 3. æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec -it yyc3-postgres psql -U yyc3_user -d yyc3_nas_ecs

# 4. æ£€æŸ¥æ•°æ®åº“é…ç½®
cat /opt/YYC3-NAS-ECS/.env.local | grep DB_

# 5. å°è¯•æ¢å¤æ•°æ®åº“è¿æ¥
docker-compose restart postgres

# 6. å¦‚æ— æ³•æ¢å¤ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“
# æ›´æ–°æ•°æ®åº“è¿æ¥é…ç½®
```

**åœºæ™¯ 3: å®‰å…¨æ¼æ´å‘ç°**

**åº”æ€¥æ­¥éª¤**:

```bash
# 1. ç«‹å³éš”ç¦»å—å½±å“ç³»ç»Ÿ
# åœæ­¢ç›¸å…³æœåŠ¡
docker-compose stop

# 2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
sudo journalctl -n 1000
sudo lastlog
sudo last

# 3. æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹
ps aux
sudo netstat -tlnp

# 4. æ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶
sudo apt update && sudo apt upgrade -y

# 5. æ›´æ–°å¯†ç å’Œå¯†é’¥
# æ›´æ–°æ‰€æœ‰è®¿é—®å‡­è¯

# 6. æ¢å¤æœåŠ¡
docker-compose start

# 7. åŠ å¼ºå®‰å…¨æªæ–½
# æ›´æ–°é˜²ç«å¢™è§„åˆ™
# å¯ç”¨å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. åº”ç”¨å±‚ä¼˜åŒ–

#### 1.1 API æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–æªæ–½**:

```python
# 1. å¯ç”¨æ•°æ®åº“è¿æ¥æ± 
from sqlalchemy import create_engine
from sqlalchemy.pool import QueuePool

engine = create_engine(
    DATABASE_URL,
    poolclass=QueuePool,
    pool_size=10,
    max_overflow=20,
    pool_timeout=30,
    pool_recycle=3600
)

# 2. å¯ç”¨ Redis ç¼“å­˜
import redis
from functools import wraps

redis_client = redis.Redis(host='localhost', port=6379, db=0)

def cache_result(expire=3600):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            cache_key = f"{func.__name__}:{str(args)}:{str(kwargs)}"
            cached_result = redis_client.get(cache_key)
            if cached_result:
                return json.loads(cached_result)
            result = func(*args, **kwargs)
            redis_client.setex(cache_key, expire, json.dumps(result))
            return result
        return wrapper
    return decorator

# 3. å¯ç”¨å¼‚æ­¥å¤„ç†
import asyncio
from fastapi import FastAPI

app = FastAPI()

@app.get("/api/v1/async-data")
async def get_async_data():
    data = await fetch_data_async()
    return {"data": data}
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯• API æ€§èƒ½
ab -n 1000 -c 10 https://your-domain.com/api/v1/status

# æ£€æŸ¥å“åº”æ—¶é—´
# ç›®æ ‡: P95 < 200ms
```

#### 1.2 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–æªæ–½**:

```javascript
// 1. å¯ç”¨ä»£ç åˆ†å‰²
import { lazy, Suspense } from 'react';

const LazyComponent = lazy(() => import('./LazyComponent'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <LazyComponent />
    </Suspense>
  );
}

// 2. å¯ç”¨å›¾ç‰‡æ‡’åŠ è½½
const LazyImage = ({ src, alt }) => {
  const [loaded, setLoaded] = useState(false);
  const imgRef = useRef(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setLoaded(true);
          observer.disconnect();
        }
      },
      { threshold: 0.1 }
    );

    if (imgRef.current) {
      observer.observe(imgRef.current);
    }

    return () => observer.disconnect();
  }, []);

  return (
    <img
      ref={imgRef}
      src={loaded ? src : ''}
      alt={alt}
      loading="lazy"
    />
  );
};

// 3. å¯ç”¨è¯·æ±‚ç¼“å­˜
import { useSWRConfig } from 'swr';

function useCachedData(key, fetcher) {
  const { cache } = useSWRConfig();
  return useSWR(key, fetcher, {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
  });
}
```

**éªŒè¯æ–¹æ³•**:

```bash
# ä½¿ç”¨ Lighthouse æµ‹è¯•å‰ç«¯æ€§èƒ½
npx lighthouse https://your-domain.com --view

# æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
# ç›®æ ‡:
# - FCP < 1.5s
# - LCP < 2.5s
# - FID < 100ms
# - CLS < 0.1
```

### 2. ç³»ç»Ÿå±‚ä¼˜åŒ–

#### 2.1 å†…æ ¸å‚æ•°ä¼˜åŒ–

**æ“ä½œå‘½ä»¤**:

```bash
# 1. ç¼–è¾‘å†…æ ¸å‚æ•°é…ç½®
sudo vim /etc/sysctl.conf
```

**é…ç½®å†…å®¹**:

```bash
# ç½‘ç»œä¼˜åŒ–
net.core.somaxconn = 65535
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.ip_local_port_range = 1024 65535

# æ–‡ä»¶æè¿°ç¬¦ä¼˜åŒ–
fs.file-max = 65535
fs.inotify.max_user_watches = 524288

# å†…å­˜ä¼˜åŒ–
vm.swappiness = 10
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 2. åº”ç”¨å†…æ ¸å‚æ•°
sudo sysctl -p

# 3. éªŒè¯å†…æ ¸å‚æ•°
sysctl -a | grep -E 'somaxconn|tcp_max_syn_backlog|file-max'
```

#### 2.2 æ–‡ä»¶æè¿°ç¬¦ä¼˜åŒ–

**æ“ä½œå‘½ä»¤**:

```bash
# 1. ç¼–è¾‘ limits é…ç½®
sudo vim /etc/security/limits.conf
```

**é…ç½®å†…å®¹**:

```bash
* soft nofile 65535
* hard nofile 65535
* soft nproc 65535
* hard nproc 65535
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 2. ç¼–è¾‘ systemd é…ç½®
sudo vim /etc/systemd/system.conf
```

**é…ç½®å†…å®¹**:

```ini
[Manager]
DefaultLimitNOFILE=65535
DefaultLimitNPROC=65535
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 3. é‡å¯ç³»ç»Ÿ
sudo reboot

# 4. éªŒè¯æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
ulimit -n
ulimit -u
```

### 3. æ•°æ®åº“ä¼˜åŒ–

#### 3.1 PostgreSQL ä¼˜åŒ–

**ä¼˜åŒ–æªæ–½**:

```sql
-- 1. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_messages_created_at ON messages(created_at);

-- 2. ä¼˜åŒ–æŸ¥è¯¢
EXPLAIN ANALYZE
SELECT * FROM users WHERE email = 'user@example.com';

-- 3. é…ç½®è¿æ¥æ± 
ALTER SYSTEM SET max_connections = 200;
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';
ALTER SYSTEM SET maintenance_work_mem = '64MB';
ALTER SYSTEM SET checkpoint_completion_target = 0.9;
ALTER SYSTEM SET wal_buffers = '16MB';
ALTER SYSTEM SET default_statistics_target = 100;

-- 4. é‡è½½é…ç½®
SELECT pg_reload_conf();
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥æ•°æ®åº“æ€§èƒ½
docker exec -it yyc3-postgres psql -U yyc3_user -d yyc3_nas_ecs -c "SELECT * FROM pg_stat_activity;"

# æ£€æŸ¥æ…¢æŸ¥è¯¢
docker exec -it yyc3-postgres psql -U yyc3_user -d yyc3_nas_ecs -c "SELECT * FROM pg_stat_statements ORDER BY total_time DESC LIMIT 10;"
```

#### 3.2 Redis ä¼˜åŒ–

**ä¼˜åŒ–æªæ–½**:

```bash
# 1. ç¼–è¾‘ Redis é…ç½®
sudo vim /etc/redis/redis.conf
```

**é…ç½®å†…å®¹**:

```bash
# å†…å­˜ä¼˜åŒ–
maxmemory 1gb
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–ä¼˜åŒ–
save 900 1
save 300 10
save 60 10000

# æ€§èƒ½ä¼˜åŒ–
tcp-backlog 511
timeout 0
tcp-keepalive 300

# æ—¥å¿—ä¼˜åŒ–
loglevel notice
logfile /var/log/redis/redis.log
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 2. é‡å¯ Redis
sudo systemctl restart redis

# 3. éªŒè¯ Redis æ€§èƒ½
redis-cli info stats
redis-cli info memory
```

---

## ğŸ”’ å®‰å…¨åŠ å›º

### 1. ç³»ç»Ÿå®‰å…¨

#### 1.1 é˜²ç«å¢™é…ç½®

**æ“ä½œå‘½ä»¤**:

```bash
# 1. é…ç½® UFW é˜²ç«å¢™
sudo ufw default deny incoming
sudo ufw default allow outgoing

# 2. å…è®¸å¿…è¦ç«¯å£
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 7001/tcp
sudo ufw allow 7500/tcp

# 3. å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# 4. æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status verbose
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status numbered

# æµ‹è¯•ç«¯å£è®¿é—®
nmap -p 22,80,443,7001,7500 your-ecs-ip
```

#### 1.2 SSH å®‰å…¨é…ç½®

**æ“ä½œå‘½ä»¤**:

```bash
# 1. ç¼–è¾‘ SSH é…ç½®
sudo vim /etc/ssh/sshd_config
```

**é…ç½®å†…å®¹**:

```bash
# ç¦ç”¨ root ç™»å½•
PermitRootLogin no

# ç¦ç”¨å¯†ç ç™»å½•
PasswordAuthentication no

# åªå…è®¸å¯†é’¥è®¤è¯
PubkeyAuthentication yes

# é™åˆ¶ç™»å½•ç”¨æˆ·
AllowUsers deploy

# ä¿®æ”¹é»˜è®¤ç«¯å£
Port 2222

# é™åˆ¶ç™»å½•å°è¯•
MaxAuthTries 3
LoginGraceTime 60

# ç¦ç”¨ç©ºå¯†ç 
PermitEmptyPasswords no
```

**æ“ä½œå‘½ä»¤ï¼ˆç»§ç»­ï¼‰**:

```bash
# 2. é‡å¯ SSH æœåŠ¡
sudo systemctl restart sshd

# 3. éªŒè¯ SSH é…ç½®
sudo sshd -t
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯• SSH è¿æ¥
ssh -p 2222 deploy@your-ecs-ip

# æ£€æŸ¥ SSH æ—¥å¿—
sudo tail -f /var/log/auth.log
```

### 2. åº”ç”¨å®‰å…¨

#### 2.1 API å®‰å…¨é…ç½®

**é…ç½®æªæ–½**:

```python
# 1. å¯ç”¨ CORS
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-domain.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 2. å¯ç”¨é€Ÿç‡é™åˆ¶
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter

@app.get("/api/v1/data")
@limiter.limit("100/minute")
async def get_data(request: Request):
    return {"data": "sample"}

# 3. å¯ç”¨è¾“å…¥éªŒè¯
from pydantic import BaseModel, validator

class UserData(BaseModel):
    email: str
    password: str

    @validator('email')
    def email_must_be_valid(cls, v):
        if '@' not in v:
            raise ValueError('must be a valid email')
        return v

    @validator('password')
    def password_must_be_strong(cls, v):
        if len(v) < 8:
            raise ValueError('must be at least 8 characters')
        return v
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯• CORS é…ç½®
curl -H "Origin: https://your-domain.com" \
     -H "Access-Control-Request-Method: GET" \
     -X OPTIONS https://your-domain.com/api/v1/data

# æµ‹è¯•é€Ÿç‡é™åˆ¶
for i in {1..150}; do
  curl https://your-domain.com/api/v1/data
done

# æµ‹è¯•è¾“å…¥éªŒè¯
curl -X POST https://your-domain.com/api/v1/users \
  -H "Content-Type: application/json" \
  -d '{"email": "invalid-email", "password": "short"}'
```

#### 2.2 å‰ç«¯å®‰å…¨é…ç½®

**é…ç½®æªæ–½**:

```javascript
// 1. é…ç½® CSP
const helmet = require('helmet');
app.use(
  helmet.contentSecurityPolicy({
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'", "'unsafe-inline'", "'unsafe-eval'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
      connectSrc: ["'self'", "https://your-domain.com"],
    },
  })
);

// 2. é…ç½® XSS é˜²æŠ¤
app.use(helmet.xssFilter());

// 3. é…ç½®ç‚¹å‡»åŠ«æŒé˜²æŠ¤
app.use(helmet.frameguard({ action: 'deny' }));

// 4. é…ç½® HSTS
app.use(
  helmet.hsts({
    maxAge: 31536000,
    includeSubDomains: true,
    preload: true,
  })
);
```

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥å®‰å…¨å¤´
curl -I https://your-domain.com

# ä½¿ç”¨å®‰å…¨æ‰«æå·¥å…·
npx lighthouse https://your-domain.com --view
```

### 3. æ•°æ®å®‰å…¨

#### 3.1 æ•°æ®åŠ å¯†

**åŠ å¯†æªæ–½**:

```python
# 1. æ•°æ®åº“è¿æ¥åŠ å¯†
DATABASE_URL = "postgresql://user:password@host:port/dbname?sslmode=require"

# 2. æ•æ„Ÿæ•°æ®åŠ å¯†
from cryptography.fernet import Fernet

key = Fernet.generate_key()
cipher_suite = Fernet(key)

def encrypt_data(data: str) -> str:
    return cipher_suite.encrypt(data.encode()).decode()

def decrypt_data(encrypted_data: str) -> str:
    return cipher_suite.decrypt(encrypted_data.encode()).decode()

# 3. æ–‡ä»¶åŠ å¯†
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend

def encrypt_file(input_file: str, output_file: str, key: bytes):
    iv = os.urandom(16)
    cipher = Cipher(algorithms.AES(key), modes.CFB(iv), backend=default_backend())
    encryptor = cipher.encryptor()

    with open(input_file, 'rb') as f_in, open(output_file, 'wb') as f_out:
        f_out.write(iv)
        while True:
            chunk = f_in.read(4096)
            if not chunk:
                break
            f_out.write(encryptor.update(chunk))
        f_out.write(encryptor.finalize())
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯•æ•°æ®åŠ å¯†
python3 -c "
from cryptography.fernet import Fernet
key = Fernet.generate_key()
cipher_suite = Fernet(key)
encrypted = cipher_suite.encrypt(b'test data')
decrypted = cipher_suite.decrypt(encrypted)
print(f'Encrypted: {encrypted}')
print(f'Decrypted: {decrypted}')
"
```

#### 3.2 æ•°æ®å¤‡ä»½åŠ å¯†

**å¤‡ä»½åŠ å¯†**:

```bash
# 1. ä½¿ç”¨ GPG åŠ å¯†å¤‡ä»½
gpg --symmetric --cipher-algo AES256 backup.sql

# 2. åŠ å¯†å‹ç¼©å¤‡ä»½
tar -czf - backup.sql | gpg --symmetric --cipher-algo AES256 > backup.sql.tar.gz.gpg

# 3. è§£å¯†å¤‡ä»½
gpg --decrypt backup.sql.gpg > backup.sql
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯•åŠ å¯†å¤‡ä»½
echo "test data" > test.txt
gpg --symmetric --cipher-algo AES256 test.txt
gpg --decrypt test.txt.gpg

# éªŒè¯æ•°æ®å®Œæ•´æ€§
md5sum test.txt
md5sum test.txt.gpg
```

---

## ğŸ“ å˜æ›´ç®¡ç†

### 1. å˜æ›´æµç¨‹

#### 1.1 å˜æ›´ç”³è¯·

**å˜æ›´ç”³è¯·æ¨¡æ¿**:

```markdown
# å˜æ›´ç”³è¯·å•

## åŸºæœ¬ä¿¡æ¯
- å˜æ›´ç¼–å·: CHG-2026-001
- ç”³è¯·æ—¥æœŸ: 2026-01-14
- ç”³è¯·äºº: å§“å
- éƒ¨é—¨: éƒ¨é—¨åç§°

## å˜æ›´æè¿°
- å˜æ›´ç±»å‹: [åŠŸèƒ½å¢å¼º/ç¼ºé™·ä¿®å¤/å®‰å…¨åŠ å›º/æ€§èƒ½ä¼˜åŒ–]
- å˜æ›´å†…å®¹: è¯¦ç»†æè¿°å˜æ›´å†…å®¹
- å˜æ›´åŸå› : è¯´æ˜å˜æ›´çš„åŸå› å’ŒèƒŒæ™¯

## å½±å“åˆ†æ
- å½±å“èŒƒå›´: åˆ—å‡ºå—å½±å“çš„ç³»ç»Ÿå’ŒæœåŠ¡
- å½±å“ç¨‹åº¦: [é«˜/ä¸­/ä½]
- é£é™©è¯„ä¼°: è¯„ä¼°å˜æ›´å¯èƒ½å¸¦æ¥çš„é£é™©

## å®æ–½è®¡åˆ’
- å®æ–½æ—¶é—´: è®¡åˆ’å®æ–½çš„æ—¶é—´
- å®æ–½æ­¥éª¤: è¯¦ç»†åˆ—å‡ºå®æ–½æ­¥éª¤
- å›æ»šæ–¹æ¡ˆ: å¦‚æœå˜æ›´å¤±è´¥ï¼Œå¦‚ä½•å›æ»š

## å®¡æ‰¹æ„è§
- æŠ€æœ¯è´Ÿè´£äºº: å®¡æ‰¹æ„è§å’Œç­¾å
- è¿ç»´è´Ÿè´£äºº: å®¡æ‰¹æ„è§å’Œç­¾å
- é¡¹ç›®è´Ÿè´£äºº: å®¡æ‰¹æ„è§å’Œç­¾å
```

#### 1.2 å˜æ›´å®æ–½

**å®æ–½æ­¥éª¤**:

```bash
# 1. åˆ›å»ºå˜æ›´åˆ†æ”¯
git checkout -b feature/change-request-001

# 2. å®æ–½å˜æ›´
# ä¿®æ”¹ä»£ç å’Œé…ç½®æ–‡ä»¶

# 3. æµ‹è¯•å˜æ›´
npm test
npm run build

# 4. æäº¤å˜æ›´
git add .
git commit -m "feat: implement change request 001"

# 5. æ¨é€å˜æ›´
git push origin feature/change-request-001

# 6. åˆ›å»º Pull Request
# åœ¨ GitHub ä¸Šåˆ›å»º PR

# 7. ä»£ç å®¡æŸ¥
# ç­‰å¾…ä»£ç å®¡æŸ¥é€šè¿‡

# 8. åˆå¹¶å˜æ›´
git checkout main
git merge feature/change-request-001

# 9. éƒ¨ç½²å˜æ›´
docker-compose up -d --build

# 10. éªŒè¯å˜æ›´
# æ‰§è¡Œæµ‹è¯•å’ŒéªŒè¯
```

#### 1.3 å˜æ›´éªŒè¯

**éªŒè¯æ­¥éª¤**:

```bash
# 1. åŠŸèƒ½éªŒè¯
curl https://your-domain.com/api/v1/status

# 2. æ€§èƒ½éªŒè¯
ab -n 1000 -c 10 https://your-domain.com/api/v1/status

# 3. å®‰å…¨éªŒè¯
npx lighthouse https://your-domain.com --view

# 4. æ—¥å¿—éªŒè¯
docker-compose logs -f

# 5. ç›‘æ§éªŒè¯
# æ£€æŸ¥ Prometheus å’Œ Grafana
```

### 2. ç‰ˆæœ¬ç®¡ç†

#### 2.1 ç‰ˆæœ¬å·è§„èŒƒ

**ç‰ˆæœ¬å·æ ¼å¼**: `ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·`

- **ä¸»ç‰ˆæœ¬å·**: ä¸å…¼å®¹çš„ API ä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·**: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **ä¿®è®¢å·**: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

**ç¤ºä¾‹**:

```
1.0.0 - åˆå§‹ç‰ˆæœ¬
1.1.0 - æ–°å¢åŠŸèƒ½
1.1.1 - ä¿®å¤ bug
2.0.0 - é‡å¤§æ›´æ–°
```

#### 2.2 å‘å¸ƒæµç¨‹

**å‘å¸ƒæ­¥éª¤**:

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
vim package.json
# ä¿®æ”¹ version å­—æ®µ

# 2. åˆ›å»ºå‘å¸ƒæ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0"

# 3. æ¨é€æ ‡ç­¾
git push origin v1.0.0

# 4. åˆ›å»ºå‘å¸ƒè¯´æ˜
# åœ¨ GitHub ä¸Šåˆ›å»º Release

# 5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.prod.yml up -d

# 6. éªŒè¯å‘å¸ƒ
# æ‰§è¡Œç”Ÿäº§ç¯å¢ƒéªŒè¯
```

---

## ğŸ“š é™„å½•

### A. ç«¯å£æ˜ å°„è¡¨

| æœåŠ¡ | å†…éƒ¨ç«¯å£ | å¤–éƒ¨ç«¯å£ | åè®® | å­åŸŸå | è¯´æ˜ |
|------|---------|---------|------|--------|------|
| API æœåŠ¡ | 6000 | - | HTTP | api.0379.email | RESTful API |
| NAS æœåŠ¡ | 6001 | - | HTTP | nas.0379.email | NAS æœ¬åœ°æœåŠ¡ |
| é‚®ä»¶æœåŠ¡ | 6002 | - | HTTP | mail.0379.email | é‚®ä»¶å‘é€æœåŠ¡ |
| LLM æœåŠ¡ | 6003 | - | HTTP | llm.0379.email | AI æ¨¡å‹æœåŠ¡ |
| ç®¡ç†é¢æ¿ | 6005 | - | HTTP | admin.0379.email | Web ç®¡ç†ç•Œé¢ |
| ç›‘æ§æœåŠ¡ | 6006 | - | HTTP | monitor.0379.email | ç³»ç»Ÿç›‘æ§æœåŠ¡ |
| DDNS æœåŠ¡ | 6007 | - | HTTP | ddns.0379.email | åŠ¨æ€ DNS æœåŠ¡ |
| Redis | 6379 | 6379 | TCP | - | ç¼“å­˜æœåŠ¡ |
| FRP æœåŠ¡å™¨ | 7001 | 7001 | TCP | - | FRP æœåŠ¡ç«¯å£ |
| FRP ç®¡ç†é¢æ¿ | 7500 | 7500 | TCP | - | FRP ç®¡ç†ç•Œé¢ |
| HTTP è™šæ‹Ÿä¸»æœº | 18080 | 18080 | HTTP | - | Web æœåŠ¡å…¥å£ |
| HTTPS è™šæ‹Ÿä¸»æœº | 4443 | 4443 | HTTPS | - | å®‰å…¨ Web æœåŠ¡å…¥å£ |

### B. ç¯å¢ƒå˜é‡æ¸…å•

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| API_PORT | 6000 | API æœåŠ¡ç«¯å£ |
| NAS_PORT | 6001 | NAS æœåŠ¡ç«¯å£ |
| MAIL_PORT | 6002 | é‚®ä»¶æœåŠ¡ç«¯å£ |
| LLM_PORT | 6003 | LLM æœåŠ¡ç«¯å£ |
| ADMIN_PORT | 6005 | ç®¡ç†é¢æ¿ç«¯å£ |
| MONITOR_PORT | 6006 | ç›‘æ§æœåŠ¡ç«¯å£ |
| DDNS_PORT | 6007 | DDNS æœåŠ¡ç«¯å£ |
| REDIS_PORT | 6379 | Redis ç«¯å£ |
| ECS_HOST | 8.152.195.33 | ECS æœåŠ¡å™¨åœ°å€ |
| NAS_HOST | your-nas-ip | NAS æœåŠ¡å™¨åœ°å€ |
| FRP_SERVER_ADDR | 8.152.195.33 | FRP æœåŠ¡å™¨åœ°å€ |
| FRP_SERVER_PORT | 7001 | FRP æœåŠ¡å™¨ç«¯å£ |
| FRP_AUTH_TOKEN | yyc3_nas | FRP è®¤è¯ä»¤ç‰Œ |
| SUBDOMAIN_HOST | 0379.email | å­åŸŸåä¸»æœº |
| DB_HOST | localhost | æ•°æ®åº“åœ°å€ |
| DB_PORT | 5432 | æ•°æ®åº“ç«¯å£ |
| DB_NAME | yyc3_nas_ecs | æ•°æ®åº“åç§° |
| DB_USER | yyc3_user | æ•°æ®åº“ç”¨æˆ· |
| DB_PASSWORD | your-db-password | æ•°æ®åº“å¯†ç  |
| REDIS_HOST | localhost | Redis åœ°å€ |
| REDIS_PASSWORD | your-redis-password | Redis å¯†ç  |
| API_BASE_URL | http://localhost:6000 | API åŸºç¡€åœ°å€ |
| API_TIMEOUT | 30000 | API è¶…æ—¶æ—¶é—´(ms) |
| LLM_API_KEY | your-llm-api-key | LLM API å¯†é’¥ |
| LLM_MODEL | gpt-4 | LLM æ¨¡å‹ |
| LLM_MAX_TOKENS | 2000 | LLM æœ€å¤§ä»¤ç‰Œæ•° |

---

<div align="center">

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for the Future***ã€
> ã€Œ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***ã€

</div>
