# YYC3-NAS-ECS æ—¥å¿—æœåŠ¡ä½¿ç”¨æŒ‡å—

> **YYCÂ³ å›¢é˜Ÿæ™ºèƒ½åº”ç”¨å¼€å‘æ ‡å‡†è§„èŒƒ**  
> **è¨€å¯è±¡é™ | è¯­æ¢æœªæ¥**  
> **Words Initiate Quadrants, Language Serves as Core for the Future**

---

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ—¥å¿—çº§åˆ«](#æ—¥å¿—çº§åˆ«)
- [æ—¥å¿—åˆ†ç±»](#æ—¥å¿—åˆ†ç±»)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [åŸºç¡€åŠŸèƒ½](#åŸºç¡€åŠŸèƒ½)
- [é«˜çº§æŸ¥è¯¢](#é«˜çº§æŸ¥è¯¢)
- [ç»Ÿè®¡åˆ†æ](#ç»Ÿè®¡åˆ†æ)
- [å¯¼å‡ºä¸‹è½½](#å¯¼å‡ºä¸‹è½½)
- [Reacté›†æˆ](#reacté›†æˆ)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [APIå‚è€ƒ](#apiå‚è€ƒ)

---

## æ¦‚è¿°

YYC3-NAS-ECS æ—¥å¿—æœåŠ¡æä¾›å…¨é¢çš„æ—¥å¿—æ”¶é›†ã€å­˜å‚¨ã€æŸ¥è¯¢å’Œå¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒå¤šç»´åº¦æ—¥å¿—åˆ†æå’Œå®æ—¶ç›‘æ§ã€‚è¯¥æœåŠ¡é‡‡ç”¨æœ¬åœ°å­˜å‚¨æœºåˆ¶ï¼Œç¡®ä¿æ—¥å¿—æ•°æ®çš„æŒä¹…åŒ–å’Œå¿«é€Ÿè®¿é—®ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å¤šçº§åˆ«æ—¥å¿—æ”¯æŒ**ï¼šDEBUGã€INFOã€WARNã€ERRORã€FATAL
- **åˆ†ç±»ç®¡ç†**ï¼šç³»ç»Ÿã€è®¤è¯ã€APIã€æ•°æ®åº“ã€é‚®ä»¶ã€FRPã€DDNSã€LLMã€å¤‡ä»½ã€ç›‘æ§
- **çµæ´»æŸ¥è¯¢**ï¼šæ”¯æŒå¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢å’Œå…³é”®è¯æœç´¢
- **ç»Ÿè®¡åˆ†æ**ï¼šæä¾›æ—¥å¿—ç»Ÿè®¡å’Œé”™è¯¯ç‡åˆ†æ
- **å¤šæ ¼å¼å¯¼å‡º**ï¼šæ”¯æŒJSONã€CSVã€TXTæ ¼å¼å¯¼å‡º
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡ä¿å­˜æœºåˆ¶ï¼Œå‡å°‘å­˜å‚¨æ“ä½œ

---

## æ—¥å¿—çº§åˆ«

| çº§åˆ« | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `DEBUG` | è°ƒè¯•ä¿¡æ¯ | å¼€å‘è°ƒè¯•ã€è¯¦ç»†æ‰§è¡Œæµç¨‹ |
| `INFO` | ä¸€èˆ¬ä¿¡æ¯ | æ­£å¸¸æ“ä½œã€çŠ¶æ€å˜æ›´ |
| `WARN` | è­¦å‘Šä¿¡æ¯ | æ½œåœ¨é—®é¢˜ã€éå…³é”®é”™è¯¯ |
| `ERROR` | é”™è¯¯ä¿¡æ¯ | æ“ä½œå¤±è´¥ã€å¼‚å¸¸æƒ…å†µ |
| `FATAL` | è‡´å‘½é”™è¯¯ | ç³»ç»Ÿå´©æºƒã€ä¸¥é‡æ•…éšœ |

---

## æ—¥å¿—åˆ†ç±»

| åˆ†ç±» | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `SYSTEM` | ç³»ç»Ÿæ—¥å¿— | ç³»ç»Ÿå¯åŠ¨ã€é…ç½®åŠ è½½ |
| `AUTH` | è®¤è¯æ—¥å¿— | ç”¨æˆ·ç™»å½•ã€æƒé™éªŒè¯ |
| `API` | APIæ—¥å¿— | æ¥å£è°ƒç”¨ã€è¯·æ±‚å“åº” |
| `DATABASE` | æ•°æ®åº“æ—¥å¿— | æŸ¥è¯¢æ‰§è¡Œã€æ•°æ®å˜æ›´ |
| `EMAIL` | é‚®ä»¶æ—¥å¿— | é‚®ä»¶å‘é€ã€æ¥æ”¶çŠ¶æ€ |
| `FRP` | FRPæ—¥å¿— | éš§é“ç®¡ç†ã€è¿æ¥çŠ¶æ€ |
| `DDNS` | DDNSæ—¥å¿— | åŸŸåè§£æã€IPæ›´æ–° |
| `LLM` | LLMæ—¥å¿— | AIè°ƒç”¨ã€æ¨¡å‹å“åº” |
| `BACKUP` | å¤‡ä»½æ—¥å¿— | å¤‡ä»½æ‰§è¡Œã€æ¢å¤æ“ä½œ |
| `MONITORING` | ç›‘æ§æ—¥å¿— | æ€§èƒ½æŒ‡æ ‡ã€å‘Šè­¦è§¦å‘ |

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### åŸºç¡€ä½¿ç”¨

```typescript
import { logService } from '@/services/logService';

// æ·»åŠ æ—¥å¿—
logService.addLog({
  level: 'INFO',
  category: 'SYSTEM',
  service: 'UserService',
  message: 'ç”¨æˆ·ç™»å½•æˆåŠŸ',
  userId: 'user-123'
});

// æŸ¥è¯¢æ—¥å¿—
const logs = logService.getLogs({
  level: 'ERROR',
  category: 'API'
}, 100);

// è·å–ç»Ÿè®¡ä¿¡æ¯
const stats = logService.getStats();
console.log('æ€»æ—¥å¿—æ•°:', stats.total);
console.log('é”™è¯¯ç‡:', stats.errorRate);
```

---

## åŸºç¡€åŠŸèƒ½

### æ·»åŠ æ—¥å¿—

```typescript
import { logService } from '@/services/logService';
import { LogLevel, LogCategory } from '@/types/logs';

// åŸºç¡€æ—¥å¿—
logService.addLog({
  level: LogLevel.INFO,
  category: LogCategory.SYSTEM,
  service: 'UserService',
  message: 'ç”¨æˆ·ç™»å½•æˆåŠŸ',
  userId: 'user-123'
});

// å¸¦æ‰§è¡Œæ—¶é—´çš„æ—¥å¿—
logService.addLog({
  level: LogLevel.INFO,
  category: LogCategory.API,
  service: 'APIService',
  message: 'APIè¯·æ±‚å®Œæˆ',
  duration: 150
});

// é”™è¯¯æ—¥å¿—
logService.addLog({
  level: LogLevel.ERROR,
  category: LogCategory.DATABASE,
  service: 'DatabaseService',
  message: 'æ•°æ®åº“è¿æ¥å¤±è´¥',
  userId: 'user-123'
});
```

### æŸ¥è¯¢æ—¥å¿—

```typescript
// è·å–æ‰€æœ‰æ—¥å¿—
const allLogs = logService.getLogs();

// æŒ‰çº§åˆ«æŸ¥è¯¢
const errorLogs = logService.getLogs({
  level: LogLevel.ERROR
});

// æŒ‰åˆ†ç±»æŸ¥è¯¢
const apiLogs = logService.getLogs({
  category: LogCategory.API
});

// æŒ‰æœåŠ¡æŸ¥è¯¢
const serviceLogs = logService.getLogs({
  service: 'UserService'
});

// é™åˆ¶è¿”å›æ•°é‡
const recentLogs = logService.getLogs({}, 100);

// ç»„åˆæ¡ä»¶æŸ¥è¯¢
const filteredLogs = logService.getLogs({
  level: LogLevel.ERROR,
  category: LogCategory.API,
  startTime: '2026-01-01T00:00:00.000Z',
  endTime: '2026-01-31T23:59:59.999Z'
}, 50);
```

### è·å–å•æ¡æ—¥å¿—

```typescript
// æ ¹æ®IDè·å–æ—¥å¿—
const log = logService.getLogById('1234567890-abc123');

if (log) {
  console.log('æ—¥å¿—è¯¦æƒ…:', log);
}
```

### è·å–æœ€è¿‘æ—¥å¿—

```typescript
// è·å–æœ€è¿‘100æ¡æ—¥å¿—
const recentLogs = logService.getRecentLogs(100);

// è·å–æœ€è¿‘50æ¡é”™è¯¯æ—¥å¿—
const errorLogs = logService.getErrorLogs(50);
```

### æœç´¢æ—¥å¿—

```typescript
// æœç´¢åŒ…å«å…³é”®è¯çš„æ—¥å¿—
const searchResults = logService.searchLogs('æ•°æ®åº“è¿æ¥å¤±è´¥');

// é™åˆ¶æœç´¢ç»“æœæ•°é‡
const limitedResults = logService.searchLogs('API', 100);
```

### æ¸…é™¤æ—¥å¿—

```typescript
// æ¸…é™¤æ‰€æœ‰æ—¥å¿—
const remainingCount = logService.clearLogs();

// æ¸…é™¤æŒ‡å®šæ¡ä»¶çš„æ—¥å¿—
const remainingCount = logService.clearLogs({
  level: LogLevel.DEBUG
});

// åˆ é™¤å•æ¡æ—¥å¿—
const deleted = logService.deleteLog('1234567890-abc123');
```

---

## é«˜çº§æŸ¥è¯¢

### æ—¶é—´èŒƒå›´æŸ¥è¯¢

```typescript
// æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µçš„æ—¥å¿—
const timeFilteredLogs = logService.getLogs({
  startTime: '2026-01-01T00:00:00.000Z',
  endTime: '2026-01-31T23:59:59.999Z'
});

// æŸ¥è¯¢æœ€è¿‘24å°æ—¶çš„æ—¥å¿—
const now = new Date();
const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);

const recentLogs = logService.getLogs({
  startTime: yesterday.toISOString(),
  endTime: now.toISOString()
});
```

### å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢

```typescript
// å¤æ‚æŸ¥è¯¢æ¡ä»¶
const complexQuery = logService.getLogs({
  level: LogLevel.ERROR,
  category: LogCategory.API,
  service: 'UserService',
  startTime: '2026-01-01T00:00:00.000Z',
  endTime: '2026-01-31T23:59:59.999Z',
  keyword: 'ç™»å½•',
  userId: 'user-123',
  minDuration: 100,
  maxDuration: 1000
});
```

### æ‰§è¡Œæ—¶é—´è¿‡æ»¤

```typescript
// æŸ¥è¯¢æ‰§è¡Œæ—¶é—´è¶…è¿‡500msçš„æ—¥å¿—
const slowLogs = logService.getLogs({
  minDuration: 500
});

// æŸ¥è¯¢æ‰§è¡Œæ—¶é—´åœ¨100-500msä¹‹é—´çš„æ—¥å¿—
const normalLogs = logService.getLogs({
  minDuration: 100,
  maxDuration: 500
});
```

### ç”¨æˆ·æ—¥å¿—æŸ¥è¯¢

```typescript
// æŸ¥è¯¢ç‰¹å®šç”¨æˆ·çš„æ—¥å¿—
const userLogs = logService.getLogs({
  userId: 'user-123'
});

// æŸ¥è¯¢ç‰¹å®šç”¨æˆ·çš„é”™è¯¯æ—¥å¿—
const userErrors = logService.getLogs({
  userId: 'user-123',
  level: LogLevel.ERROR
});
```

---

## ç»Ÿè®¡åˆ†æ

### è·å–ç»Ÿè®¡ä¿¡æ¯

```typescript
// è·å–æ‰€æœ‰æ—¥å¿—çš„ç»Ÿè®¡ä¿¡æ¯
const stats = logService.getStats();

console.log('æ€»æ—¥å¿—æ•°:', stats.total);
console.log('é”™è¯¯ç‡:', stats.errorRate);
console.log('å¹³å‡æ‰§è¡Œæ—¶é—´:', stats.avgDuration);
console.log('æŒ‰çº§åˆ«ç»Ÿè®¡:', stats.byLevel);
console.log('æŒ‰åˆ†ç±»ç»Ÿè®¡:', stats.byCategory);
console.log('æŒ‰æœåŠ¡ç»Ÿè®¡:', stats.byService);
```

### æŒ‰æ¡ä»¶ç»Ÿè®¡

```typescript
// ç»Ÿè®¡é”™è¯¯æ—¥å¿—
const errorStats = logService.getStats({
  level: LogLevel.ERROR
});

// ç»Ÿè®¡ç‰¹å®šæœåŠ¡çš„æ—¥å¿—
const serviceStats = logService.getStats({
  service: 'UserService'
});

// ç»Ÿè®¡ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
const timeStats = logService.getStats({
  startTime: '2026-01-01T00:00:00.000Z',
  endTime: '2026-01-31T23:59:59.999Z'
});
```

### é”™è¯¯ç‡åˆ†æ

```typescript
// è·å–æ•´ä½“é”™è¯¯ç‡
const stats = logService.getStats();
const errorRate = stats.errorRate;

console.log('é”™è¯¯ç‡:', errorRate.toFixed(2) + '%');

// è·å–ç‰¹å®šæœåŠ¡çš„é”™è¯¯ç‡
const serviceStats = logService.getStats({
  service: 'UserService'
});
const serviceErrorRate = serviceStats.errorRate;

console.log('UserServiceé”™è¯¯ç‡:', serviceErrorRate.toFixed(2) + '%');
```

### æ€§èƒ½åˆ†æ

```typescript
// åˆ†æAPIæ€§èƒ½
const apiStats = logService.getStats({
  category: LogCategory.API
});

console.log('APIå¹³å‡å“åº”æ—¶é—´:', apiStats.avgDuration, 'ms');

// åˆ†ææ…¢æŸ¥è¯¢
const slowQueries = logService.getLogs({
  category: LogCategory.DATABASE,
  minDuration: 1000
});

console.log('æ…¢æŸ¥è¯¢æ•°é‡:', slowQueries.length);
```

---

## å¯¼å‡ºä¸‹è½½

### å¯¼å‡ºä¸ºJSON

```typescript
// å¯¼å‡ºæ‰€æœ‰æ—¥å¿—ä¸ºJSON
const jsonContent = logService.exportLogs(undefined, {
  format: 'json'
});

// å¯¼å‡ºæŒ‡å®šæ¡ä»¶çš„æ—¥å¿—
const filteredJson = logService.exportLogs({
  level: LogLevel.ERROR,
  category: LogCategory.API
}, {
  format: 'json'
});
```

### å¯¼å‡ºä¸ºCSV

```typescript
// å¯¼å‡ºæ‰€æœ‰æ—¥å¿—ä¸ºCSV
const csvContent = logService.exportLogs(undefined, {
  format: 'csv'
});

// å¯¼å‡ºæŒ‡å®šæ¡ä»¶çš„æ—¥å¿—
const filteredCsv = logService.exportLogs({
  level: LogLevel.ERROR
}, {
  format: 'csv'
});
```

### å¯¼å‡ºä¸ºTXT

```typescript
// å¯¼å‡ºæ‰€æœ‰æ—¥å¿—ä¸ºTXT
const txtContent = logService.exportLogs(undefined, {
  format: 'txt'
});

// å¯¼å‡ºæŒ‡å®šæ¡ä»¶çš„æ—¥å¿—
const filteredTxt = logService.exportLogs({
  level: LogLevel.ERROR,
  category: LogCategory.API
}, {
  format: 'txt'
});
```

### ä¸‹è½½æ—¥å¿—æ–‡ä»¶

```typescript
// ä¸‹è½½æ‰€æœ‰æ—¥å¿—ä¸ºJSON
logService.downloadLogs(undefined, {
  format: 'json'
});

// ä¸‹è½½é”™è¯¯æ—¥å¿—ä¸ºCSV
logService.downloadLogs({
  level: LogLevel.ERROR
}, {
  format: 'csv'
});

// ä¸‹è½½æœ€è¿‘24å°æ—¶çš„æ—¥å¿—ä¸ºTXT
const now = new Date();
const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);

logService.downloadLogs({
  startTime: yesterday.toISOString(),
  endTime: now.toISOString()
}, {
  format: 'txt'
});
```

---

## Reacté›†æˆ

### æ—¥å¿—æŸ¥çœ‹ç»„ä»¶

```typescript
import React, { useState, useEffect } from 'react';
import { logService } from '@/services/logService';
import { LogLevel, LogCategory, LogFilter } from '@/types/logs';

export function LogViewer() {
  const [logs, setLogs] = useState<LogEntry[]>([]);
  const [filter, setFilter] = useState<LogFilter>({});
  const [loading, setLoading] = useState(false);

  const loadLogs = async () => {
    setLoading(true);
    try {
      const result = logService.getLogs(filter, 100);
      setLogs(result);
    } catch (error) {
      console.error('åŠ è½½æ—¥å¿—å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadLogs();
  }, [filter]);

  const handleExport = (format: 'json' | 'csv' | 'txt') => {
    logService.downloadLogs(filter, { format });
  };

  const handleClear = () => {
    logService.clearLogs(filter);
    loadLogs();
  };

  return (
    <div className="log-viewer">
      <div className="log-filters">
        <select 
          value={filter.level || ''} 
          onChange={(e) => setFilter({ ...filter, level: e.target.value as LogLevel })}
        >
          <option value="">æ‰€æœ‰çº§åˆ«</option>
          <option value={LogLevel.DEBUG}>DEBUG</option>
          <option value={LogLevel.INFO}>INFO</option>
          <option value={LogLevel.WARN}>WARN</option>
          <option value={LogLevel.ERROR}>ERROR</option>
          <option value={LogLevel.FATAL}>FATAL</option>
        </select>

        <select 
          value={filter.category || ''} 
          onChange={(e) => setFilter({ ...filter, category: e.target.value as LogCategory })}
        >
          <option value="">æ‰€æœ‰åˆ†ç±»</option>
          <option value={LogCategory.SYSTEM}>ç³»ç»Ÿ</option>
          <option value={LogCategory.AUTH}>è®¤è¯</option>
          <option value={LogCategory.API}>API</option>
          <option value={LogCategory.DATABASE}>æ•°æ®åº“</option>
          <option value={LogCategory.EMAIL}>é‚®ä»¶</option>
          <option value={LogCategory.FRP}>FRP</option>
          <option value={LogCategory.DDNS}>DDNS</option>
          <option value={LogCategory.LLM}>LLM</option>
          <option value={LogCategory.BACKUP}>å¤‡ä»½</option>
          <option value={LogCategory.MONITORING}>ç›‘æ§</option>
        </select>

        <input 
          type="text" 
          placeholder="æœç´¢å…³é”®è¯"
          value={filter.keyword || ''}
          onChange={(e) => setFilter({ ...filter, keyword: e.target.value })}
        />

        <button onClick={loadLogs}>åˆ·æ–°</button>
        <button onClick={() => handleExport('json')}>å¯¼å‡ºJSON</button>
        <button onClick={() => handleExport('csv')}>å¯¼å‡ºCSV</button>
        <button onClick={() => handleExport('txt')}>å¯¼å‡ºTXT</button>
        <button onClick={handleClear}>æ¸…é™¤</button>
      </div>

      <div className="log-list">
        {loading ? (
          <div className="loading">åŠ è½½ä¸­...</div>
        ) : (
          logs.map(log => (
            <div key={log.id} className={`log-item log-${log.level.toLowerCase()}`}>
              <div className="log-header">
                <span className="log-time">{new Date(log.timestamp).toLocaleString()}</span>
                <span className={`log-level log-${log.level.toLowerCase()}`}>{log.level}</span>
                <span className="log-category">{log.category}</span>
                <span className="log-service">{log.service}</span>
              </div>
              <div className="log-message">{log.message}</div>
              {log.duration && (
                <div className="log-duration">æ‰§è¡Œæ—¶é—´: {log.duration}ms</div>
              )}
              {log.userId && (
                <div className="log-user">ç”¨æˆ·ID: {log.userId}</div>
              )}
            </div>
          ))
        )}
      </div>
    </div>
  );
}
```

### æ—¥å¿—ç»Ÿè®¡ç»„ä»¶

```typescript
import React, { useState, useEffect } from 'react';
import { logService } from '@/services/logService';
import { LogStats, LogFilter } from '@/types/logs';

export function LogStats() {
  const [stats, setStats] = useState<LogStats | null>(null);
  const [filter, setFilter] = useState<LogFilter>({});

  const loadStats = () => {
    const result = logService.getStats(filter);
    setStats(result);
  };

  useEffect(() => {
    loadStats();
    const interval = setInterval(loadStats, 60000); // æ¯åˆ†é’Ÿåˆ·æ–°
    return () => clearInterval(interval);
  }, [filter]);

  if (!stats) {
    return <div className="loading">åŠ è½½ä¸­...</div>;
  }

  return (
    <div className="log-stats">
      <div className="stat-card">
        <h3>æ€»æ—¥å¿—æ•°</h3>
        <div className="stat-value">{stats.total}</div>
      </div>

      <div className="stat-card">
        <h3>é”™è¯¯ç‡</h3>
        <div className={`stat-value ${stats.errorRate > 5 ? 'error' : 'normal'}`}>
          {stats.errorRate.toFixed(2)}%
        </div>
      </div>

      {stats.avgDuration && (
        <div className="stat-card">
          <h3>å¹³å‡æ‰§è¡Œæ—¶é—´</h3>
          <div className="stat-value">{stats.avgDuration.toFixed(2)}ms</div>
        </div>
      )}

      <div className="stat-section">
        <h3>æŒ‰çº§åˆ«ç»Ÿè®¡</h3>
        <div className="level-stats">
          <div className="level-item">
            <span className="level-name">DEBUG</span>
            <span className="level-count">{stats.byLevel.DEBUG}</span>
          </div>
          <div className="level-item">
            <span className="level-name">INFO</span>
            <span className="level-count">{stats.byLevel.INFO}</span>
          </div>
          <div className="level-item">
            <span className="level-name">WARN</span>
            <span className="level-count">{stats.byLevel.WARN}</span>
          </div>
          <div className="level-item">
            <span className="level-name">ERROR</span>
            <span className="level-count">{stats.byLevel.ERROR}</span>
          </div>
          <div className="level-item">
            <span className="level-name">FATAL</span>
            <span className="level-count">{stats.byLevel.FATAL}</span>
          </div>
        </div>
      </div>

      <div className="stat-section">
        <h3>æŒ‰åˆ†ç±»ç»Ÿè®¡</h3>
        <div className="category-stats">
          {Object.entries(stats.byCategory).map(([category, count]) => (
            <div key={category} className="category-item">
              <span className="category-name">{category}</span>
              <span className="category-count">{count}</span>
            </div>
          ))}
        </div>
      </div>

      <div className="stat-section">
        <h3>æŒ‰æœåŠ¡ç»Ÿè®¡</h3>
        <div className="service-stats">
          {Object.entries(stats.byService)
            .sort(([, a], [, b]) => b - a)
            .slice(0, 10)
            .map(([service, count]) => (
              <div key={service} className="service-item">
                <span className="service-name">{service}</span>
                <span className="service-count">{count}</span>
              </div>
            ))}
        </div>
      </div>
    </div>
  );
}
```

### React Hook

```typescript
import { useState, useEffect, useCallback } from 'react';
import { logService } from '@/services/logService';
import { LogEntry, LogFilter, LogStats } from '@/types/logs';

export function useLogs(filter?: LogFilter, limit?: number) {
  const [logs, setLogs] = useState<LogEntry[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchLogs = useCallback(() => {
    setLoading(true);
    setError(null);
    
    try {
      const result = logService.getLogs(filter, limit);
      setLogs(result);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'è·å–æ—¥å¿—å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }, [filter, limit]);

  useEffect(() => {
    fetchLogs();
  }, [fetchLogs]);

  return { logs, loading, error, refetch: fetchLogs };
}

export function useLogStats(filter?: LogFilter) {
  const [stats, setStats] = useState<LogStats | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchStats = useCallback(() => {
    setLoading(true);
    setError(null);
    
    try {
      const result = logService.getStats(filter);
      setStats(result);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }, [filter]);

  useEffect(() => {
    fetchStats();
    const interval = setInterval(fetchStats, 60000); // æ¯åˆ†é’Ÿåˆ·æ–°
    return () => clearInterval(interval);
  }, [fetchStats]);

  return { stats, loading, error, refetch: fetchStats };
}

export function useRecentLogs(count: number = 100) {
  const [logs, setLogs] = useState<LogEntry[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchRecentLogs = useCallback(() => {
    setLoading(true);
    setError(null);
    
    try {
      const result = logService.getRecentLogs(count);
      setLogs(result);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'è·å–æœ€è¿‘æ—¥å¿—å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }, [count]);

  useEffect(() => {
    fetchRecentLogs();
    const interval = setInterval(fetchRecentLogs, 10000); // æ¯10ç§’åˆ·æ–°
    return () => clearInterval(interval);
  }, [fetchRecentLogs]);

  return { logs, loading, error, refetch: fetchRecentLogs };
}
```

---

## æœ€ä½³å®è·µ

### æ—¥å¿—çº§åˆ«ä½¿ç”¨

```typescript
// DEBUGçº§åˆ«ï¼šå¼€å‘è°ƒè¯•ä¿¡æ¯
logService.addLog({
  level: LogLevel.DEBUG,
  category: LogCategory.API,
  service: 'APIService',
  message: 'APIè¯·æ±‚å‚æ•°: ' + JSON.stringify(params)
});

// INFOçº§åˆ«ï¼šæ­£å¸¸æ“ä½œä¿¡æ¯
logService.addLog({
  level: LogLevel.INFO,
  category: LogCategory.AUTH,
  service: 'AuthService',
  message: 'ç”¨æˆ·ç™»å½•æˆåŠŸ',
  userId: userId
});

// WARNçº§åˆ«ï¼šæ½œåœ¨é—®é¢˜è­¦å‘Š
logService.addLog({
  level: LogLevel.WARN,
  category: LogCategory.DATABASE,
  service: 'DatabaseService',
  message: 'æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡è¶…è¿‡80%',
  userId: userId
});

// ERRORçº§åˆ«ï¼šæ“ä½œå¤±è´¥é”™è¯¯
logService.addLog({
  level: LogLevel.ERROR,
  category: LogCategory.API,
  service: 'APIService',
  message: 'APIè¯·æ±‚å¤±è´¥: ' + error.message,
  userId: userId
});

// FATALçº§åˆ«ï¼šç³»ç»Ÿè‡´å‘½é”™è¯¯
logService.addLog({
  level: LogLevel.FATAL,
  category: LogCategory.SYSTEM,
  service: 'SystemService',
  message: 'ç³»ç»Ÿå´©æºƒï¼Œæ— æ³•ç»§ç»­è¿è¡Œ'
});
```

### æ€§èƒ½ç›‘æ§

```typescript
// è®°å½•APIè¯·æ±‚æ€§èƒ½
async function apiRequest(url: string, data: any) {
  const startTime = Date.now();
  
  try {
    const response = await fetch(url, {
      method: 'POST',
      body: JSON.stringify(data)
    });
    
    const duration = Date.now() - startTime;
    
    logService.addLog({
      level: LogLevel.INFO,
      category: LogCategory.API,
      service: 'APIService',
      message: `APIè¯·æ±‚æˆåŠŸ: ${url}`,
      duration: duration
    });
    
    return await response.json();
  } catch (error) {
    const duration = Date.now() - startTime;
    
    logService.addLog({
      level: LogLevel.ERROR,
      category: LogCategory.API,
      service: 'APIService',
      message: `APIè¯·æ±‚å¤±è´¥: ${url} - ${error.message}`,
      duration: duration
    });
    
    throw error;
  }
}
```

### é”™è¯¯è¿½è¸ª

```typescript
// è®°å½•é”™è¯¯è¯¦æƒ…
function handleError(error: Error, context: any) {
  logService.addLog({
    level: LogLevel.ERROR,
    category: LogCategory.SYSTEM,
    service: 'ErrorHandler',
    message: `é”™è¯¯: ${error.message}`,
    userId: context.userId
  });
  
  // è®°å½•é”™è¯¯å †æ ˆï¼ˆDEBUGçº§åˆ«ï¼‰
  logService.addLog({
    level: LogLevel.DEBUG,
    category: LogCategory.SYSTEM,
    service: 'ErrorHandler',
    message: `é”™è¯¯å †æ ˆ: ${error.stack}`
  });
}
```

### æ—¥å¿—æ¸…ç†ç­–ç•¥

```typescript
// å®šæœŸæ¸…ç†æ—§æ—¥å¿—
function cleanupOldLogs() {
  const thirtyDaysAgo = new Date();
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
  
  const remainingCount = logService.clearLogs({
    endTime: thirtyDaysAgo.toISOString()
  });
  
  console.log('æ¸…ç†åå‰©ä½™æ—¥å¿—æ•°:', remainingCount);
}

// æ¸…ç†DEBUGçº§åˆ«æ—¥å¿—
function cleanupDebugLogs() {
  const remainingCount = logService.clearLogs({
    level: LogLevel.DEBUG
  });
  
  console.log('æ¸…ç†åå‰©ä½™æ—¥å¿—æ•°:', remainingCount);
}
```

### æ—¥å¿—å¯¼å‡ºç­–ç•¥

```typescript
// å®šæœŸå¯¼å‡ºé”™è¯¯æ—¥å¿—
function exportErrorLogs() {
  const now = new Date();
  const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
  
  logService.downloadLogs({
    level: LogLevel.ERROR,
    startTime: yesterday.toISOString(),
    endTime: now.toISOString()
  }, {
    format: 'json'
  });
}

// å¯¼å‡ºæ€§èƒ½æ—¥å¿—
function exportPerformanceLogs() {
  logService.downloadLogs({
    category: LogCategory.API,
    minDuration: 500
  }, {
    format: 'csv'
  });
}
```

---

## APIå‚è€ƒ

### LogService

#### æ–¹æ³•

##### `addLog(entry: Omit<LogEntry, 'id' | 'timestamp'>): LogEntry`

æ·»åŠ æ—¥å¿—æ¡ç›®ã€‚

**å‚æ•°ï¼š**
- `entry` - æ—¥å¿—æ¡ç›®ï¼ˆä¸åŒ…å«IDå’Œæ—¶é—´æˆ³ï¼‰

**è¿”å›ï¼š**
- `LogEntry` - æ·»åŠ çš„æ—¥å¿—æ¡ç›®ï¼ˆåŒ…å«è‡ªåŠ¨ç”Ÿæˆçš„IDå’Œæ—¶é—´æˆ³ï¼‰

**ç¤ºä¾‹ï¼š**
```typescript
const log = logService.addLog({
  level: LogLevel.INFO,
  category: LogCategory.SYSTEM,
  service: 'UserService',
  message: 'ç”¨æˆ·ç™»å½•æˆåŠŸ',
  userId: 'user-123'
});
```

---

##### `getLogs(filter?: LogFilter, limit?: number): LogEntry[]`

è·å–æ—¥å¿—åˆ—è¡¨ã€‚

**å‚æ•°ï¼š**
- `filter` - å¯é€‰ï¼Œæ—¥å¿—è¿‡æ»¤æ¡ä»¶
- `limit` - å¯é€‰ï¼Œè¿”å›æ—¥å¿—æ•°é‡é™åˆ¶

**è¿”å›ï¼š**
- `LogEntry[]` - æ—¥å¿—åˆ—è¡¨

**ç¤ºä¾‹ï¼š**
```typescript
const logs = logService.getLogs({
  level: LogLevel.ERROR
}, 100);
```

---

##### `getLogById(id: string): LogEntry | undefined`

æ ¹æ®IDè·å–æ—¥å¿—æ¡ç›®ã€‚

**å‚æ•°ï¼š**
- `id` - æ—¥å¿—ID

**è¿”å›ï¼š**
- `LogEntry | undefined` - æ—¥å¿—æ¡ç›®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›undefined

**ç¤ºä¾‹ï¼š**
```typescript
const log = logService.getLogById('1234567890-abc123');
```

---

##### `getStats(filter?: LogFilter): LogStats`

è·å–æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ã€‚

**å‚æ•°ï¼š**
- `filter` - å¯é€‰ï¼Œæ—¥å¿—è¿‡æ»¤æ¡ä»¶

**è¿”å›ï¼š**
- `LogStats` - ç»Ÿè®¡ä¿¡æ¯

**ç¤ºä¾‹ï¼š**
```typescript
const stats = logService.getStats({
  level: LogLevel.ERROR
});
```

---

##### `exportLogs(filter?: LogFilter, options?: LogExportOptions): string`

å¯¼å‡ºæ—¥å¿—ä¸ºå­—ç¬¦ä¸²ã€‚

**å‚æ•°ï¼š**
- `filter` - å¯é€‰ï¼Œæ—¥å¿—è¿‡æ»¤æ¡ä»¶
- `options` - å¯é€‰ï¼Œå¯¼å‡ºé€‰é¡¹ï¼ˆæ ¼å¼ï¼šjsonã€csvã€txtï¼‰

**è¿”å›ï¼š**
- `string` - å¯¼å‡ºçš„æ—¥å¿—å­—ç¬¦ä¸²

**ç¤ºä¾‹ï¼š**
```typescript
const jsonContent = logService.exportLogs(undefined, {
  format: 'json'
});
```

---

##### `downloadLogs(filter?: LogFilter, options?: LogExportOptions): void`

ä¸‹è½½æ—¥å¿—æ–‡ä»¶ã€‚

**å‚æ•°ï¼š**
- `filter` - å¯é€‰ï¼Œæ—¥å¿—è¿‡æ»¤æ¡ä»¶
- `options` - å¯é€‰ï¼Œå¯¼å‡ºé€‰é¡¹ï¼ˆæ ¼å¼ï¼šjsonã€csvã€txtï¼‰

**è¿”å›ï¼š**
- `void`

**ç¤ºä¾‹ï¼š**
```typescript
logService.downloadLogs({
  level: LogLevel.ERROR
}, {
  format: 'csv'
});
```

---

##### `clearLogs(filter?: LogFilter): number`

æ¸…é™¤æ—¥å¿—ã€‚

**å‚æ•°ï¼š**
- `filter` - å¯é€‰ï¼Œæ—¥å¿—è¿‡æ»¤æ¡ä»¶

**è¿”å›ï¼š**
- `number` - å‰©ä½™æ—¥å¿—æ•°é‡

**ç¤ºä¾‹ï¼š**
```typescript
const remainingCount = logService.clearLogs({
  level: LogLevel.DEBUG
});
```

---

##### `deleteLog(id: string): boolean`

åˆ é™¤æŒ‡å®šIDçš„æ—¥å¿—ã€‚

**å‚æ•°ï¼š**
- `id` - æ—¥å¿—ID

**è¿”å›ï¼š**
- `boolean` - æ˜¯å¦åˆ é™¤æˆåŠŸ

**ç¤ºä¾‹ï¼š**
```typescript
const deleted = logService.deleteLog('1234567890-abc123');
```

---

##### `getRecentLogs(count?: number): LogEntry[]`

è·å–æœ€è¿‘çš„æ—¥å¿—ã€‚

**å‚æ•°ï¼š**
- `count` - å¯é€‰ï¼Œæ—¥å¿—æ•°é‡ï¼Œé»˜è®¤100

**è¿”å›ï¼š**
- `LogEntry[]` - æ—¥å¿—åˆ—è¡¨

**ç¤ºä¾‹ï¼š**
```typescript
const recentLogs = logService.getRecentLogs(100);
```

---

##### `getErrorLogs(count?: number): LogEntry[]`

è·å–é”™è¯¯æ—¥å¿—ã€‚

**å‚æ•°ï¼š**
- `count` - å¯é€‰ï¼Œæ—¥å¿—æ•°é‡ï¼Œé»˜è®¤50

**è¿”å›ï¼š**
- `LogEntry[]` - é”™è¯¯æ—¥å¿—åˆ—è¡¨

**ç¤ºä¾‹ï¼š**
```typescript
const errorLogs = logService.getErrorLogs(50);
```

---

##### `searchLogs(keyword: string, limit?: number): LogEntry[]`

æœç´¢æ—¥å¿—ã€‚

**å‚æ•°ï¼š**
- `keyword` - æœç´¢å…³é”®è¯
- `limit` - å¯é€‰ï¼Œè¿”å›ç»“æœæ•°é‡é™åˆ¶

**è¿”å›ï¼š**
- `LogEntry[]` - æœç´¢ç»“æœåˆ—è¡¨

**ç¤ºä¾‹ï¼š**
```typescript
const results = logService.searchLogs('API', 100);
```

---

### ç±»å‹å®šä¹‰

#### LogEntry

```typescript
interface LogEntry {
  id: string;
  timestamp: string;
  level: LogLevel;
  category: LogCategory;
  service: string;
  message: string;
  userId?: string;
  duration?: number;
}
```

#### LogLevel

```typescript
enum LogLevel {
  DEBUG = 'DEBUG',
  INFO = 'INFO',
  WARN = 'WARN',
  ERROR = 'ERROR',
  FATAL = 'FATAL'
}
```

#### LogCategory

```typescript
enum LogCategory {
  SYSTEM = 'SYSTEM',
  AUTH = 'AUTH',
  API = 'API',
  DATABASE = 'DATABASE',
  EMAIL = 'EMAIL',
  FRP = 'FRP',
  DDNS = 'DDNS',
  LLM = 'LLM',
  BACKUP = 'BACKUP',
  MONITORING = 'MONITORING'
}
```

#### LogFilter

```typescript
interface LogFilter {
  level?: LogLevel;
  category?: LogCategory;
  service?: string;
  startTime?: string;
  endTime?: string;
  keyword?: string;
  userId?: string;
  minDuration?: number;
  maxDuration?: number;
}
```

#### LogStats

```typescript
interface LogStats {
  total: number;
  byLevel: Record<LogLevel, number>;
  byCategory: Record<LogCategory, number>;
  byService: Record<string, number>;
  errorRate: number;
  avgDuration?: number;
}
```

#### LogExportOptions

```typescript
interface LogExportOptions {
  format?: 'json' | 'csv' | 'txt';
}
```

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é™åˆ¶æ—¥å¿—æ•°é‡ï¼Ÿ

A: æ—¥å¿—æœåŠ¡ä¼šè‡ªåŠ¨é™åˆ¶æ—¥å¿—æ•°é‡ï¼Œé»˜è®¤æœ€å¤§10000æ¡ã€‚å½“æ—¥å¿—æ•°é‡è¶…è¿‡é™åˆ¶æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„æ—¥å¿—ã€‚

### Q: å¦‚ä½•æé«˜æ—¥å¿—æŸ¥è¯¢æ€§èƒ½ï¼Ÿ

A: æ—¥å¿—æœåŠ¡é‡‡ç”¨æ‰¹é‡ä¿å­˜æœºåˆ¶ï¼Œæ¯100æ¡æ—¥å¿—ä¿å­˜ä¸€æ¬¡ï¼Œå‡å°‘å­˜å‚¨æ“ä½œã€‚å¯¹äºå¤§é‡æ—¥å¿—ï¼Œå»ºè®®ä½¿ç”¨è¿‡æ»¤æ¡ä»¶é™åˆ¶æŸ¥è¯¢èŒƒå›´ã€‚

### Q: æ—¥å¿—æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

A: æ—¥å¿—æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨çš„localStorageä¸­ï¼Œä½¿ç”¨é”®å`yyc3-system-logs`ã€‚

### Q: å¦‚ä½•å¤‡ä»½æ—¥å¿—æ•°æ®ï¼Ÿ

A: ä½¿ç”¨`downloadLogs`æ–¹æ³•å¯¼å‡ºæ—¥å¿—æ–‡ä»¶ï¼Œæ”¯æŒJSONã€CSVã€TXTæ ¼å¼ã€‚

### Q: æ—¥å¿—æœåŠ¡æ˜¯å¦æ”¯æŒå¤šæ ‡ç­¾é¡µåŒæ­¥ï¼Ÿ

A: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒå¤šæ ‡ç­¾é¡µåŒæ­¥ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µç»´æŠ¤ç‹¬ç«‹çš„æ—¥å¿—å®ä¾‹ã€‚

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-24)

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒå¤šçº§åˆ«æ—¥å¿—è®°å½•
- æ”¯æŒå¤šç»´åº¦æ—¥å¿—æŸ¥è¯¢
- æ”¯æŒæ—¥å¿—ç»Ÿè®¡åˆ†æ
- æ”¯æŒå¤šæ ¼å¼æ—¥å¿—å¯¼å‡º
- æ”¯æŒReacté›†æˆ

---

<div align="center">

> **ã€ŒYanYuCloudCubeã€**  
> **ã€Œ<admin@0379.email>ã€**  
> **ã€ŒWords Initiate Quadrants, Language Serves as Core for the Futureã€**  
> **ã€ŒAll things converge in the cloud pivot; Deep stacks ignite a new era of intelligenceã€**

</div>
